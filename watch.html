<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>دروس لغة C - أكاديمية البرمجة المتكاملة</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #4361ee;
        --secondary-color: #3a0ca3;
        --accent-color: #4cc9f0;
        --success-color: #4ade80;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --dark-color: #1e293b;
        --light-color: #f8fafc;
        --gray-color: #64748b;
        --card-bg: #ffffff;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--light-color);
        color: var(--dark-color);
        line-height: 1.6;
        overflow-x: hidden;
      }

      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* User Profile Dropdown */
      .user-profile {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
      }

      .user-avatar-small {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        /* تم تغيير الخلفية الافتراضية إلى اللون الأبيض/الرمادي */
        background: #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        border: 2px solid white;
        /* إعدادات الصورة الرمزية */
        background-size: cover;
        background-position: center;
        /* هذا مهم للتأكد من أن النص (الحرف الأول) يختفي عند تحميل الصورة */
        text-indent: -9999px;
        overflow: hidden;
      }

      /* **إضافة قاعدة جديدة لرمز الصورة المنسدلة الأكبر** */
      .user-info .user-avatar-small {
        width: 50px; /* جعلها أكبر قليلاً في القائمة المنسدلة */
        height: 50px;
        font-size: 1.2rem;
      }

      .user-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        background: white;
        min-width: 200px;
        box-shadow: var(--shadow);
        border-radius: 10px;
        padding: 1rem;
        opacity: 0;
        visibility: hidden;
        transform: translateY(0);
        transition: var(--transition);
        z-index: 1000;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #eee;
        margin-bottom: 0.5rem;
      }

      .user-name {
        font-weight: 600;
        color: var(--dark-color);
      }

      .user-email {
        font-size: 0.8rem;
        color: var(--gray-color);
      }

      .logout-btn {
        background: #ff6b6b;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        cursor: pointer;
        transition: var(--transition);
        width: 100%;
      }

      .logout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      }

      .btn {
        padding: 0.8rem 1.8rem;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        font-size: 1rem;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn i {
        margin: 0 5px;
      }

      #completeBtn {
        background: var(--success-color);
        color: white;
      }

      #completeBtn:hover:not(:disabled) {
        background: #059669;
        transform: translateY(-2px);
      }

      #prevBtn,
      #nextBtn {
        background: var(--primary-color);
        color: white;
      }

      #prevBtn:hover:not(:disabled),
      #nextBtn:hover:not(:disabled) {
        background: #1e40af;
        transform: translateY(-2px);
      }

      /* Header & Navbar */
      header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-shadow: var(--shadow);
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo-img {
        width: 50px;
        height: 50px;
        background: linear-gradient(
          45deg,
          var(--accent-color),
          var(--primary-color)
        );
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        animation: rotate 10s linear infinite;
      }

      @keyframes rotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .logo h1 {
        font-size: 1.5rem;
        white-space: nowrap;
      }

      .nav-links {
        display: flex;
        list-style: none;
        gap: 1.5rem;
      }

      .nav-link {
        color: white;
        text-decoration: none;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        transition: var(--transition);
        position: relative;
      }

      .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .dropdown {
        position: relative;
      }

      .dropdown-menu {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        min-width: 200px;
        box-shadow: var(--shadow);
        border-radius: 8px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: var(--transition);
        z-index: 100;
        padding: 0.5rem 0;
      }

      .dropdown:hover .dropdown-menu {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-menu a {
        display: block;
        padding: 0.8rem 1rem;
        color: var(--dark-color);
        text-decoration: none;
        border-bottom: 1px solid #eee;
        transition: var(--transition);
      }

      .dropdown-menu a:hover {
        background-color: #f5f5f5;
        color: var(--primary-color);
      }

      .dropdown-menu a:last-child {
        border-bottom: none;
      }

      .login-btn {
        background-color: var(--accent-color);
        border-radius: 50px;
        padding: 0.5rem 1.5rem;
      }

      .login-btn:hover {
        background-color: #3ab0d9;
      }

      .mobile-menu-btn {
        display: none;
        flex-direction: column;
        cursor: pointer;
        z-index: 1001;
      }

      .mobile-menu-btn span {
        width: 25px;
        height: 3px;
        background: white;
        margin: 3px 0;
        transition: var(--transition);
      }

      .mobile-menu-btn.active span:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }

      .mobile-menu-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .mobile-menu-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -6px);
      }

      /* Mobile Menu Overlay */
      .mobile-menu-overlay {
        position: fixed;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: var(--transition);
      }

      .mobile-menu-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .mobile-nav-links {
        position: fixed;
        top: 0;
        right: -100%;
        width: 80%;
        max-width: 300px;
        height: 100%;
        background: white;
        padding: 2rem;
        overflow-y: auto;
        transition: var(--transition);
        z-index: 1000;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      }

      .mobile-nav-links.active {
        right: 0;
      }

      .mobile-nav-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #eee;
      }

      .mobile-nav-header h2 {
        color: var(--primary-color);
      }

      .close-mobile-menu {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--dark-color);
        cursor: pointer;
      }

      .mobile-nav-links ul {
        list-style: none;
        padding: 0;
      }

      .mobile-nav-links li {
        margin-bottom: 1rem;
      }

      .mobile-nav-links a {
        color: var(--dark-color);
        text-decoration: none;
        font-size: 1.1rem;
        display: block;
        padding: 0.5rem 0;
        border-bottom: 1px solid #eee;
        transition: var(--transition);
      }

      .mobile-nav-links a:hover {
        color: var(--primary-color);
      }

      .mobile-dropdown {
        position: relative;
      }

      .mobile-dropdown-toggle {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        cursor: pointer;
      }

      .mobile-dropdown-menu {
        display: none;
        padding-left: 1rem;
        margin-top: 0.5rem;
      }

      .mobile-dropdown-menu a {
        display: block;
        padding: 0.5rem 0;
        font-size: 0.9rem;
        color: var(--gray-color);
        border-bottom: 1px solid #f0f0f0;
      }

      .mobile-dropdown-menu a:last-child {
        border-bottom: none;
      }

      .user-profile-mobile {
        border-top: 1px solid #eee;
        padding-top: 1rem;
        margin-top: 1rem;
      }

      .user-info-mobile {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding-bottom: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .user-profile-mobile .user-avatar-small {
        width: 40px;
        height: 40px;
      }

      .user-profile-mobile .logout-btn {
        width: 100%;
        margin-top: 0.5rem;
      }

      .mobile-nav-links .login-btn {
        background: var(--primary-color);
        color: white;
        border-radius: 5px;
        text-align: center;
        margin-top: 1rem;
      }

      .mobile-nav-links .login-btn:hover {
        background: var(--secondary-color);
      }

      /* Main Content */
      .main-content {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 30px;
        padding: 100px 0 50px;
      }

      @media (max-width: 992px) {
        .main-content {
          grid-template-columns: 1fr;
        }
      }

      /* Video Player Section */
      .video-section {
        height: fit-content;
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .video-header {
        padding: 25px 30px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
      }

      .course-title {
        font-size: 1.8rem;
        margin-bottom: 5px;
      }

      .course-subtitle {
        opacity: 0.9;
        font-size: 1rem;
      }

      .video-container {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
        background: #000;
      }

      .video-player {
        position: absolute;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        outline: none;
      }

      .video-placeholder {
        position: absolute;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-align: center;
        padding: 20px;
      }

      .placeholder-icon {
        font-size: 4rem;
        margin-bottom: 20px;
      }

      .placeholder-text {
        font-size: 1.2rem;
        margin-bottom: 10px;
      }

      .video-info {
        padding: 25px 30px;
      }

      .video-title {
        font-size: 1.4rem;
        margin-bottom: 15px;
        color: var(--primary-color);
      }

      .video-description {
        color: #666;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      .video-actions {
        display: flex;
        gap: 15px;
        margin-top: 25px;
      }

      /* Progress Section */
      .progress-section {
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 25px;
        height: fit-content;
        margin-bottom: 30px;
      }

      .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .progress-title {
        font-size: 1.3rem;
        color: var(--primary-color);
      }

      .progress-stats {
        text-align: center;
        margin-bottom: 25px;
      }

      .progress-percentage {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 5px;
      }

      .progress-text {
        color: #666;
        font-size: 0.9rem;
      }

      .progress-bar {
        height: 8px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 20px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 4px;
        transition: width 0.5s ease;
      }

      /* Playlist Section */
      .playlist-section {
        margin-top: 30px;
      }

      .playlist-title {
        font-size: 1.2rem;
        margin-bottom: 20px;
        color: var(--primary-color);
        padding-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
      }

      .playlist {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .playlist-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #f5f5f5;
        cursor: pointer;
        transition: var(--transition);
        border-right: 3px solid transparent;
      }

      .playlist-item:hover {
        background: #f8f9fa;
      }

      .playlist-item.active {
        background: rgba(78, 84, 200, 0.1);
        border-right-color: var(--primary-color);
      }

      .playlist-item.completed .item-title {
        color: var(--success-color);
      }

      .item-number {
        width: 30px;
        height: 30px;
        background: #e9ecef;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.8rem;
        font-weight: 600;
        margin-left: 15px;
        flex-shrink: 0;
      }

      .playlist-item.active .item-number {
        background: var(--primary-color);
        color: white;
      }

      .playlist-item.completed .item-number {
        background: var(--success-color);
        color: white;
      }

      .item-content {
        flex: 1;
      }

      .item-title {
        font-weight: 600;
        margin-bottom: 5px;
        transition: var(--transition);
      }

      .item-duration {
        font-size: 0.8rem;
        color: #666;
      }

      .item-status {
        margin-right: 10px;
        color: var(--success-color);
        opacity: 0;
        transition: var(--transition);
      }

      .playlist-item.completed .item-status {
        opacity: 1;
      }

      /* Resources Section */
      .resources-section {
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 25px;
        margin-top: 40px;
      }

      .resources-title {
        font-size: 1.3rem;
        margin-bottom: 20px;
        color: var(--primary-color);
      }

      .resources-list {
        list-style: none;
      }

      .resource-item {
        padding: 12px 0;
        border-bottom: 1px solid #f5f5f5;
        display: flex;
        align-items: center;
      }

      .resource-item:last-child {
        border-bottom: none;
      }

      .resource-icon {
        color: var(--primary-color);
        margin-left: 10px;
        width: 20px;
        text-align: center;
      }

      .resource-link {
        color: #555;
        text-decoration: none;
        transition: var(--transition);
      }

      .resource-link:hover {
        color: var(--primary-color);
      }

      /* Footer */
      .footer {
        background-color: var(--dark-color);
        color: white;
        padding: 40px 0 20px;
        margin-top: 50px;
      }

      .footer-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 30px;
        margin-bottom: 20px;
      }

      .footer-section h3 {
        margin-bottom: 15px;
        position: relative;
        padding-bottom: 10px;
      }

      .footer-section h3::after {
        content: "";
        position: absolute;
        bottom: 0;
        right: 0;
        width: 40px;
        height: 2px;
        background-color: var(--primary-color);
      }

      .footer-links {
        list-style: none;
      }

      .footer-links li {
        margin-bottom: 8px;
      }

      .footer-links a {
        color: #ccc;
        text-decoration: none;
        transition: var(--transition);
      }

      .footer-links a:hover {
        color: var(--primary-color);
        padding-right: 5px;
      }

      .copyright {
        text-align: center;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.9rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .hamburger {
          display: block;
        }

        .nav-menu {
          position: fixed;
          top: 70px;
          right: -100%;
          flex-direction: column;
          background-color: white;
          width: 80%;
          height: calc(100vh - 70px);
          transition: var(--transition);
          box-shadow: var(--shadow);
          padding-top: 20px;
        }

        .nav-menu.active {
          right: 0;
        }

        .nav-item {
          margin: 10px 0;
        }

        .main-content {
          padding: 90px 0 30px;
        }

        .video-header {
          padding: 20px;
        }

        .course-title {
          font-size: 1.5rem;
        }

        .video-info {
          padding: 20px;
        }

        .video-actions {
          flex-direction: column;
        }
      }

      @media (max-width: 576px) {
        .container {
          width: 95%;
        }

        .video-header,
        .video-info,
        .progress-section,
        .resources-section {
          padding: 15px;
        }

        .progress-section {
          margin-bottom: 20px;
        }

        .course-title {
          font-size: 1.3rem;
        }

        .progress-percentage {
          font-size: 2rem;
        }
      }

      @media (max-width: 850px) {
        .navbar {
          padding: 1rem;
        }

        .nav-links {
          display: none;
        }

        .mobile-menu-btn {
          display: flex;
        }
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: #fff;
        margin: 10% auto;
        padding: 0;
        border-radius: 8px;
        width: 80%;
        max-width: 800px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
      }

      .modal-header h3 {
        margin: 0;
        color: #1e293b;
      }

      .close-modal {
        font-size: 28px;
        font-weight: bold;
        color: #6b7280;
        cursor: pointer;
      }

      .close-modal:hover {
        color: #374151;
      }

      .modal-body {
        padding: 20px;
      }

      .modal-body pre {
        background-color: #f8fafc;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: "Courier New", monospace;
        font-size: 14px;
        line-height: 1.4;
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 15px;
      }

      .copy-btn {
        background-color: #3b82f6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
      }

      .copy-btn:hover {
        background-color: #2563eb;
      }

      .copy-btn.copied {
        background-color: #10b981;
      }
    </style>
    <script src="login-modal.js"></script>
    <script src="site-notification.js"></script>
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="logo">
          <div class="logo-img">
            <i class="fas fa-code"></i>
          </div>
          <h1>أكاديمية البرمجة المتكاملة</h1>
        </div>

        <ul class="nav-links">
          <li><a href="index.html" class="nav-link">الرئيسية</a></li>
          <li class="dropdown">
            <a href="#" class="nav-link"
              >تعلم الآن <i class="fas fa-chevron-down"></i
            ></a>
            <div class="dropdown-menu">
              <a href="examples.html">أمثلة وتطبيقات وشروحات</a>
              <a href="challenges.html">التحديات البرمجية</a>
              <a href="proplemsolving.html">مواقع حل المشاكل البرمجية</a>
            </div>
          </li>
          <li><a href="./roadmap.html" class="nav-link">خارطة الطريق</a></li>
          <li class="dropdown">
            <a href="#" class="nav-link"
              >الكورسات <i class="fas fa-chevron-down"></i
            ></a>
            <div class="dropdown-menu">
              <a href="path.php?path=basics">مسار أساسيات البرمجة</a>
              <a href="path.php?path=frontend">مسار Frontend Developer</a>
              <a href="path.php?path=backend">مسار Backend Developer</a>
            </div>
          </li>
          <li>
            <a href="project.html" class="nav-link">التكليفات والمشاريع</a>
          </li>
          <li class="user-profile" id="userProfile" style="display: none">
            <div class="user-avatar-small" id="userAvatarSmall">م</div>
            <div class="user-dropdown">
              <div class="user-info">
                <div class="user-avatar-small" id="dropdownAvatar">م</div>
                <div>
                  <div class="user-name" id="dropdownUserName"></div>
                  <div class="user-email" id="dropdownUserEmail"></div>
                </div>
              </div>
              <a
                href="profile.html"
                class="nav-link"
                style="
                  display: block;
                  text-align: right;
                  margin-bottom: 0.5rem;
                  color: black;
                  font-size: large;
                "
                ><i
                  class="fas fa-user-circle profile-icon"
                  style="margin-left: 10%"
                ></i
                >الملف الشخصي</a
              >
              <button class="logout-btn" id="logoutBtn">تسجيل الخروج</button>
            </div>
          </li>
          <li id="loginButton">
            <a href="./login1.html" class="nav-link login-btn">تسجيل الدخول</a>
          </li>
        </ul>

        <div class="mobile-menu-btn" id="mobileMenuBtn">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </nav>
    </header>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav-links" id="mobileNavLinks">
      <div class="mobile-nav-header">
        <h2>القائمة</h2>
      </div>
      <ul>
        <li><a href="index.html" class="nav-link">الرئيسية</a></li>
        <li class="mobile-dropdown">
          <div class="mobile-dropdown-toggle">
            <a href="#" class="nav-link">تعلم الآن</a>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="mobile-dropdown-menu">
            <a href="examples.html">أمثلة وتطبيقات وشروحات</a>
            <a href="challenges.html">التحديات البرمجية</a>
            <a href="proplemsolving.html">مواقع حل المشاكل البرمجية</a>
          </div>
        </li>
        <li><a href="./roadmap.html" class="nav-link">خارطة الطريق</a></li>
        <li class="mobile-dropdown">
          <div class="mobile-dropdown-toggle">
            <a href="#" class="nav-link">الكورسات</a>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="mobile-dropdown-menu">
            <a href="path.php?path=basics">مسار أساسيات البرمجة</a>
            <a href="path.php?path=frontend">مسار Frontend Developer</a>
            <a href="path.php?path=backend">مسار Backend Developer</a>
          </div>
        </li>
        <li>
          <a href="project.html" class="nav-link">التكليفات والمشاريع</a>
        </li>
        <li
          class="user-profile-mobile"
          id="userProfileMobile"
          style="display: none"
        >
          <div class="user-info-mobile">
            <div class="user-avatar-small" id="mobileAvatar">م</div>
            <div>
              <div class="user-name" id="mobileUserName"></div>
              <div class="user-email" id="mobileUserEmail"></div>
            </div>
          </div>
          <a href="profile.html" class="nav-link">
            <i class="fas fa-user-circle"></i> الملف الشخصي
          </a>
          <button class="logout-btn" id="mobileLogoutBtn">تسجيل الخروج</button>
        </li>
        <li id="loginButtonMobile">
          <a href="./login1.html" class="nav-link login-btn">تسجيل الدخول</a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="container">
      <div class="main-content">
        <!-- Video Player Section -->
        <div class="video-section">
          <div class="video-header">
            <h1 class="course-title">دورة لغة C المتكاملة</h1>
            <p class="course-subtitle">
              من الصفر إلى الاحتراف - تعلم أساسيات البرمجة بلغة C
            </p>
          </div>

          <div class="video-container">
            <!-- مشغل الفيديو الحقيقي -->
            <video class="video-player" id="videoPlayer" controls>
              المتصفح الخاص بك لا يدعم تشغيل الفيديو
            </video>

            <!-- placeholder يظهر قبل اختيار فيديو -->
            <div class="video-placeholder" id="videoPlaceholder">
              <div class="placeholder-icon">
                <i class="fas fa-play-circle"></i>
              </div>
              <div class="placeholder-text" id="currentVideoTitle">
                اختر درساً من القائمة الجانبية للبدء
              </div>
              <p>سيظهر مشغل الفيديو هنا عند اختيار درس</p>
            </div>
          </div>

          <div class="video-info">
            <h2 class="video-title" id="videoTitle">مرحباً بك في دورة لغة C</h2>
            <p class="video-description" id="videoDescription">
              اختر درساً من القائمة الجانبية لبدء التعلم. ستجد هنا جميع دروس لغة
              C مرتبة من الأساسيات إلى المستوى المتقدم.
            </p>

            <div class="video-actions">
              <button class="btn" id="prevBtn" disabled>
                <i class="fas fa-arrow-right"></i> السابق
              </button>
              <button class="btn" id="completeBtn">
                <i class="fas fa-check"></i> اكتمل المشاهدة
              </button>
              <button class="btn" id="nextBtn" disabled>
                التالي <i class="fas fa-arrow-left"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
          <!-- Progress Section -->
          <div class="progress-section">
            <div class="progress-header">
              <h3 class="progress-title">تقدمك في الدورة</h3>
              <span class="progress-percentage" id="progressPercentage"
                >0%</span
              >
            </div>

            <div class="progress-bar">
              <div
                class="progress-fill"
                id="progressFill"
                style="width: 0%"
              ></div>
            </div>

            <div class="progress-stats">
              <div class="progress-text">
                <span id="completedVideos">0</span> من
                <span id="totalVideos">20</span> درس مكتمل
              </div>
            </div>

            <!-- Playlist -->
            <div class="playlist-section">
              <h3 class="playlist-title">قائمة الدروس</h3>
              <div class="playlist" id="playlist">
                <!-- سيتم ملء القائمة تلقائياً بالجافاسكريبت -->
              </div>
            </div>
          </div>

          <!-- Resources Section -->
          <div class="resources-section">
            <h3 class="resources-title">الموارد التعليمية</h3>
            <ul class="resources-list" id="resourcesList">
              <!-- سيتم ملء الموارد تلقائياً -->
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>أكاديمية البرمجة المتكاملة</h3>
            <p>
              نحن نؤمن بقوة البرمجة في تغيير المستقبل. مهمتنا هي تمكين الأفراد
              من خلال تعليم البرمجة عالي الجودة.
            </p>
          </div>
          <div class="footer-section">
            <h3>روابط سريعة</h3>
            <ul class="footer-links">
              <li><a href="index.html">الرئيسية</a></li>
              <li><a href="path.php?path=basics">أساسيات البرمجة</a></li>
              <li><a href="path.php?path=frontend">مسار Frontend</a></li>
              <li><a href="path.php?path=backend">مسار Backend</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>اتصل بنا</h3>
            <ul class="footer-links">
              <li>
                <i class="fas fa-envelope"></i> info@programmingacademy.com
              </li>
              <li><i class="fas fa-phone"></i> +963 123 456 789</li>
            </ul>
          </div>
        </div>
        <div class="copyright">
          <p>© 2023 أكاديمية البرمجة المتكاملة. جميع الحقوق محفوظة.</p>
        </div>
      </div>
    </footer>

    <script>
      let currentUser = null;

      // دالة لعرض رسالة خطأ
      function showError(message) {
        console.error("Error:", message);
        // Could show error in a modal or alert
        showNotification(message, "error");
      }

      // Navbar Scroll Effect
      window.addEventListener("scroll", function () {
        const navbar = document.querySelector(".navbar");
        if (navbar) {
          if (window.scrollY > 50) {
            navbar.classList.add("scrolled");
          } else {
            navbar.classList.remove("scrolled");
          }
        }
      });

      // إضافة تأثيرات Hover للبطاقات (if course cards exist)
      document.addEventListener("DOMContentLoaded", function () {
        // التحقق من حالة تسجيل الدخول
        fetch("user_status.php", { credentials: "same-origin" })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            if (data.success && data.user) {
              window.currentUser = data.user;
              updateUserInterface();
              initPage();
            } else {
              // Show login modal - page requires authentication
              // Wait for modal script to be ready
              const showModal = function () {
                if (typeof showLoginModal === "function") {
                  showLoginModal({
                    message: "يجب عليك تسجيل الدخول لمشاهدة الدروس.",
                  });
                } else {
                  // Check again after a longer delay
                  setTimeout(function () {
                    if (typeof showLoginModal === "function") {
                      showLoginModal({
                        message: "يجب عليك تسجيل الدخول لمشاهدة الدروس.",
                      });
                    } else {
                      console.error(
                        "showLoginModal still not available, redirecting to login"
                      );
                      window.location.href = "login1.html";
                    }
                  }, 300);
                }
              };
              setTimeout(showModal, 50);
            }
          })
          .catch((error) => {
            console.error("Error checking login status:", error);
            // Show login modal on error
            const showModal = function () {
              if (typeof showLoginModal === "function") {
                showLoginModal({
                  message: "يجب عليك تسجيل الدخول لمشاهدة الدروس.",
                });
              } else {
                setTimeout(function () {
                  if (typeof showLoginModal === "function") {
                    showLoginModal({
                      message: "يجب عليك تسجيل الدخول لمشاهدة الدروس.",
                    });
                  } else {
                    window.location.href = "login1.html";
                  }
                }, 300);
              }
            };
            setTimeout(showModal, 50);
          });
      });

      // إضافة Smooth Scroll للروابط
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          const href = this.getAttribute("href");
          if (href && href !== "#") {
            e.preventDefault();
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
          }
        });
      });

      // معالجة أخطاء تحميل الصور
      document.addEventListener(
        "error",
        function (e) {
          if (e.target.tagName === "IMG") {
            console.error("فشل تحميل الصورة:", e.target.src);
          }
        },
        true
      );

      // Logout Functionality (additional from path.php)
      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", function () {
          fetch("logout.php").then(() => {
            currentUser = null;
            updateUserInterface();
            showNotification("تم تسجيل الخروج بنجاح!", "success");
          });
        });
      }

      // Logout (additional from path.php)
      if (document.getElementById("mobileLogoutBtn")) {
        document
          .getElementById("mobileLogoutBtn")
          .addEventListener("click", function () {
            closeMobileMenuFunc(); // Close menu first
            fetch("logout.php").then(() => {
              currentUser = null;
              updateUserInterface();
              showNotification("تم تسجيل الخروج بنجاح!", "success");
            });
          });
      }

      // Mobile Menu Toggle (additional from path.php)
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const mobileMenuOverlay = document.getElementById("mobileMenuOverlay");
      const mobileNavLinks = document.getElementById("mobileNavLinks");

      function toggleMobileMenu() {
        const isActive = mobileMenuBtn.classList.contains("active");
        if (isActive) {
          closeMobileMenuFunc();
        } else {
          openMobileMenu();
        }
      }

      function openMobileMenu() {
        mobileMenuBtn.classList.add("active");
        mobileMenuOverlay.classList.add("active");
        mobileNavLinks.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeMobileMenuFunc() {
        mobileMenuBtn.classList.remove("active");
        mobileMenuOverlay.classList.remove("active");
        mobileNavLinks.classList.remove("active");
        document.body.style.overflow = "auto";
      }

      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener("click", toggleMobileMenu);
      }

      if (mobileMenuOverlay) {
        mobileMenuOverlay.addEventListener("click", closeMobileMenuFunc);
      }

      // Mobile Dropdown Toggle
      document.querySelectorAll(".mobile-dropdown-toggle").forEach((toggle) => {
        toggle.addEventListener("click", function (e) {
          e.preventDefault();
          const menu = this.nextElementSibling;
          const icon = this.querySelector("i");
          menu.classList.toggle("active");
          if (menu.classList.contains("active")) {
            icon.classList.remove("fa-chevron-down");
            icon.classList.add("fa-chevron-up");
          } else {
            icon.classList.remove("fa-chevron-up");
            icon.classList.add("fa-chevron-down");
          }
        });
      });

      // User Interface Update (additional from path.php)
      // User Interface Update
      function updateUserInterface() {
        const currentUser = window.currentUser;
        const userProfile = document.getElementById("userProfile");
        const loginButton = document.getElementById("loginButton");
        const userProfileMobile = document.getElementById("userProfileMobile");
        const loginButtonMobile = document.getElementById("loginButtonMobile");

        if (currentUser) {
          // Show user profile, hide login
          if (userProfile) userProfile.style.display = "flex";
          if (loginButton) loginButton.style.display = "none";
          if (userProfileMobile) userProfileMobile.style.display = "block";
          if (loginButtonMobile) loginButtonMobile.style.display = "none";

          // Set user info
          const initial = currentUser.firstName
            ? currentUser.firstName.charAt(0)
            : currentUser.username
            ? currentUser.username.charAt(0)
            : "?";

          const fullName =
            currentUser.firstName && currentUser.lastName
              ? `${currentUser.firstName} ${currentUser.lastName}`
              : currentUser.username;

          const email = currentUser.email || currentUser.username;

          // Desktop
          const dropdownUserName = document.getElementById("dropdownUserName");
          const dropdownUserEmail =
            document.getElementById("dropdownUserEmail");
          if (dropdownUserName) dropdownUserName.textContent = fullName;
          if (dropdownUserEmail) dropdownUserEmail.textContent = email;

          // Mobile
          const mobileUserName = document.getElementById("mobileUserName");
          const mobileUserEmail = document.getElementById("mobileUserEmail");
          if (mobileUserName) mobileUserName.textContent = fullName;
          if (mobileUserEmail) mobileUserEmail.textContent = email;

          // Avatar
          const avatars = ["userAvatarSmall", "dropdownAvatar", "mobileAvatar"];
          avatars.forEach((id) => {
            const avatar = document.getElementById(id);
            if (avatar) {
              if (
                currentUser.avatar &&
                currentUser.avatar.startsWith("data:image")
              ) {
                avatar.style.background = `url('${currentUser.avatar}') no-repeat center center / cover`;
                avatar.textContent = "";
              } else {
                avatar.textContent = initial;
                avatar.style.background =
                  "linear-gradient(135deg, var(--accent), var(--primary))";
                avatar.style.backgroundImage = "none";
              }
            }
          });
        } else {
          // Hide user profile, show login
          if (userProfile) userProfile.style.display = "none";
          if (loginButton) loginButton.style.display = "block";
          if (userProfileMobile) userProfileMobile.style.display = "none";
          if (loginButtonMobile) loginButtonMobile.style.display = "block";

          // Set redirect URLs for login buttons
          const loginLink = document.querySelector("#loginButton a");
          if (loginLink) {
            loginLink.href =
              "login1.html?redirect=" +
              encodeURIComponent(
                window.location.pathname + window.location.search
              );
          }
          const mobileLoginLink = document.querySelector(
            "#loginButtonMobile a"
          );
          if (mobileLoginLink) {
            mobileLoginLink.href =
              "login1.html?redirect=" +
              encodeURIComponent(
                window.location.pathname + window.location.search
              );
          }
        }
      }

      // Dropdown hover functionality (additional from path.php)
      const userProfile = document.getElementById("userProfile");
      const userDropdown = document.querySelector(".user-dropdown");
      let dropdownTimeout;

      function showDropdown() {
        clearTimeout(dropdownTimeout);
        if (userDropdown) {
          userDropdown.style.opacity = "1";
          userDropdown.style.visibility = "visible";
          userDropdown.style.transform = "translateY(0)";
        }
      }

      function hideDropdown() {
        dropdownTimeout = setTimeout(() => {
          if (userDropdown) {
            userDropdown.style.opacity = "0";
            userDropdown.style.visibility = "hidden";
            userDropdown.style.transform = "translateY(0)";
          }
        }, 150); // Small delay to allow moving between elements
      }

      if (userProfile) {
        userProfile.addEventListener("mouseenter", showDropdown);
        userProfile.addEventListener("mouseleave", hideDropdown);
      }

      if (userDropdown) {
        userDropdown.addEventListener("mouseenter", showDropdown);
        userDropdown.addEventListener("mouseleave", hideDropdown);
      }

      // بيانات الدروس - سيتم تحميلها من قاعدة البيانات
      let videoLessons = [];
      let courseData = {};
      let currentVideoIndex = 0;
      let completedLessons = [];

      // العناصر الرئيسية
      const videoPlayer = document.getElementById("videoPlayer");

      // إضافة event listeners لحفظ موقع الفيديو
      let lastSavedPosition = 0;
      let isSavingPosition = false;

      videoPlayer.addEventListener("timeupdate", () => {
        // حفظ الموقع كل 10 ثوانٍ وتجنب الحفظ المتكرر
        const currentPos = Math.floor(videoPlayer.currentTime);
        if (
          currentPos % 10 === 0 &&
          currentPos > 0 &&
          currentPos !== lastSavedPosition &&
          !isSavingPosition
        ) {
          lastSavedPosition = currentPos;
          saveVideoPosition();
        }
      });

      videoPlayer.addEventListener("pause", () => {
        if (!isSavingPosition) {
          saveVideoPosition();
        }
      });

      videoPlayer.addEventListener("ended", () => {
        if (!isSavingPosition) {
          saveVideoPosition();
        }
      });

      const videoPlaceholder = document.getElementById("videoPlaceholder");
      const playlistElement = document.getElementById("playlist");
      const videoTitle = document.getElementById("videoTitle");
      const videoDescription = document.getElementById("videoDescription");
      const currentVideoTitle = document.getElementById("currentVideoTitle");
      const progressPercentage = document.getElementById("progressPercentage");
      const progressFill = document.getElementById("progressFill");
      const completedVideos = document.getElementById("completedVideos");
      const totalVideos = document.getElementById("totalVideos");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const completeBtn = document.getElementById("completeBtn");

      // إضافة event listeners للأزرار
      completeBtn.addEventListener("click", completeCurrentLesson);
      prevBtn.addEventListener("click", navigateToPrev);
      nextBtn.addEventListener("click", navigateToNext);

      // الحصول على معرف الدورة من URL
      function getCourseIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("course_id") || "1"; // افتراضياً دورة C
      }

      // التحقق من وضع الاستئناف
      function isResumeMode() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("resume") === "true";
      }

      // تحميل بيانات الدورة والدروس
      async function loadCourseData() {
        const courseId = getCourseIdFromUrl();

        // Show loading state
        document.querySelector(".course-title").textContent = "جاري التحميل...";
        document.querySelector(".course-subtitle").textContent = "";
        videoTitle.textContent = "جاري تحميل الدروس...";
        videoDescription.textContent = "يرجى الانتظار...";

        try {
          const response = await fetch(
            `fetch_lessons.php?course_id=${courseId}`
          );
          const data = await response.json();

          if (
            response.status === 401 ||
            (data.success === false && data.message === "Not authenticated")
          ) {
            // Session expired, redirect to login
            window.location.href =
              "login1.html?redirect=" +
              encodeURIComponent(
                window.location.pathname + window.location.search
              );
            return;
          }

          if (data.success) {
            courseData = data.course;
            videoLessons = data.lessons;
            completedLessons = data.lessons
              .filter((lesson) => lesson.completed)
              .map((lesson) => lesson.id);

            // تحديث عنوان الدورة
            document.querySelector(".course-title").textContent =
              courseData.title;
            document.querySelector(".course-subtitle").textContent =
              courseData.description || "";

            // تحديث التقدم
            updateProgressDisplay(data.progress);

            // عرض القائمة
            renderPlaylist();

            // تحديث أزرار التنقل
            updateNavigationButtons();

            // تحديد الفيديو الأولي للعرض
            if (isResumeMode()) {
              // وضع الاستئناف: تحميل الدرس الأخير المكتمل
              if (data.progress.last_lesson_id) {
                const lastLessonIndex = videoLessons.findIndex(
                  (lesson) => lesson.id == data.progress.last_lesson_id
                );
                if (lastLessonIndex !== -1) {
                  loadVideo(lastLessonIndex);
                } else {
                  loadVideo(0); // fallback to first video
                }
              } else {
                loadVideo(0); // no progress, start from first video
              }

              // إزالة معامل resume من URL بعد التحميل الأولي
              const url = new URL(window.location);
              url.searchParams.delete("resume");
              window.history.replaceState({}, "", url);
            } else {
              // وضع عادي: محاولة تحميل الفيديو المحفوظ في الجلسة أو الأول
              const savedVideoIndex = sessionStorage.getItem(
                `currentVideo_${courseId}`
              );
              if (savedVideoIndex !== null && videoLessons[savedVideoIndex]) {
                loadVideo(parseInt(savedVideoIndex));
              } else {
                loadVideo(0); // default to first video
              }
            }
          } else {
            console.error("Failed to load course data:", data.message);
            showNotification("فشل في تحميل بيانات الدورة", "error");
          }
        } catch (error) {
          console.error("Error loading course data:", error);

          // Check if it's an authentication error
          if (
            error.message.includes("401") ||
            error.message.includes("Unauthorized")
          ) {
            window.location.href =
              "login1.html?redirect=" +
              encodeURIComponent(
                window.location.pathname + window.location.search
              );
            return;
          }

          showNotification("خطأ في تحميل البيانات", "error");
        }
      }

      // تهيئة الصفحة
      function initPage() {
        loadCourseData();
      }

      // عرض قائمة الدروس
      function renderPlaylist() {
        playlistElement.innerHTML = "";

        videoLessons.forEach((lesson, index) => {
          const isCompleted = lesson.completed;
          const isActive = index === currentVideoIndex;

          const lessonElement = document.createElement("div");
          lessonElement.className = `playlist-item ${
            isActive ? "active" : ""
          } ${isCompleted ? "completed" : ""}`;
          lessonElement.onclick = () => loadVideo(index);

          lessonElement.innerHTML = `
                    <div class="item-number">${index + 1}</div>
                    <div class="item-content">
                        <div class="item-title">${lesson.title}</div>
                    </div>
                    <div class="item-status">
                        <i class="fas fa-check"></i>
                    </div>
                `;

          playlistElement.appendChild(lessonElement);
        });
      }

      // تحميل الفيديو
      function loadVideo(index) {
        currentVideoIndex = index;
        const lesson = videoLessons[index];

        // حفظ الفيديو الحالي في الجلسة (إلا في وضع الاستئناف)
        if (!isResumeMode()) {
          const courseId = getCourseIdFromUrl();
          sessionStorage.setItem(`currentVideo_${courseId}`, index.toString());
        }

        // تحديث واجهة الفيديو
        videoTitle.textContent = lesson.title;
        videoDescription.textContent = lesson.description;
        currentVideoTitle.textContent = lesson.title;

        // تحميل وتشغيل الفيديو
        videoPlayer.src = lesson.video_url;
        videoPlaceholder.style.display = "none";
        videoPlayer.style.display = "block";

        // تحديث القائمة
        renderPlaylist();

        // تحديث أزرار التنقل
        updateNavigationButtons();

        // تحديث الموارد
        updateResources();

        // حفظ الموقع إذا كان هناك
        if (lesson.last_position > 0) {
          videoPlayer.currentTime = lesson.last_position;
        }
      }

      // تحديث أزرار التنقل
      function updateNavigationButtons() {
        prevBtn.disabled = currentVideoIndex === 0;
        nextBtn.disabled = currentVideoIndex === videoLessons.length - 1;

        const isCompleted = completedLessons.includes(
          videoLessons[currentVideoIndex].id
        );
        completeBtn.innerHTML = isCompleted
          ? '<i class="fas fa-redo"></i> إعادة التعلم'
          : '<i class="fas fa-check"></i> اكتمل المشاهدة';
      }

      // تحديث التقدم
      function updateProgressDisplay(progress) {
        progressPercentage.textContent = `${progress.percentage}%`;
        progressFill.style.width = `${progress.percentage}%`;
        completedVideos.textContent = progress.completed_lessons;
        totalVideos.textContent = progress.total_lessons;
      }

      // إكمال الدرس أو إعادة التعلم
      async function completeCurrentLesson() {
        const currentLesson = videoLessons[currentVideoIndex];
        const isCompleted = currentLesson.completed;
        const action = isCompleted ? "mark_incomplete" : "mark_complete";

        try {
          const response = await fetch("update_progress.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              lesson_id: currentLesson.id,
              action: action,
              position: Math.floor(videoPlayer.currentTime),
            }),
          });

          const data = await response.json();

          if (
            response.status === 401 ||
            (data.success === false && data.message === "Not authenticated")
          ) {
            // Session expired, redirect to login
            window.location.href =
              "login1.html?redirect=" +
              encodeURIComponent(
                window.location.pathname + window.location.search
              );
            return;
          }

          if (data.success) {
            // Update local data
            if (isCompleted) {
              // Relearning: mark as incomplete
              currentLesson.completed = false;
              const index = completedLessons.indexOf(currentLesson.id);
              if (index > -1) {
                completedLessons.splice(index, 1);
              }
            } else {
              // Completing: mark as complete
              currentLesson.completed = true;
              completedLessons.push(currentLesson.id);
            }

            // Update progress display with API data if available, otherwise local calculation
            if (data.progress) {
              updateProgressDisplay(data.progress);
            } else {
              // Fallback: calculate locally
              const completedCount = completedLessons.length;
              const totalCount = videoLessons.length;
              const percentage =
                totalCount > 0
                  ? Math.round((completedCount / totalCount) * 100)
                  : 0;
              updateProgressDisplay({
                completed_lessons: completedCount,
                total_lessons: totalCount,
                percentage: percentage,
              });
            }

            // Update playlist
            renderPlaylist();

            // Update buttons
            updateNavigationButtons();
          } else {
            showNotification(
              "فشل في تحديث حالة الدرس: " + data.message,
              "error"
            );
          }
        } catch (error) {
          console.error("Error updating lesson status:", error);
          showNotification("خطأ في تحديث حالة الدرس", "error");
        }
      }

      // التنقل بين الدروس
      function navigateToNext() {
        if (currentVideoIndex < videoLessons.length - 1) {
          loadVideo(currentVideoIndex + 1);
        }
      }

      function navigateToPrev() {
        if (currentVideoIndex > 0) {
          loadVideo(currentVideoIndex - 1);
        }
      }

      // حفظ موقع الفيديو
      async function saveVideoPosition() {
        if (videoLessons.length === 0 || isSavingPosition) return;

        const currentLesson = videoLessons[currentVideoIndex];
        const position = Math.floor(videoPlayer.currentTime);

        // Don't save if position is 0 or invalid
        if (position <= 0 || isNaN(position)) return;

        isSavingPosition = true;

        try {
          const response = await fetch("update_progress.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              lesson_id: currentLesson.id,
              action: "update_position",
              position: position,
            }),
          });

          if (response.ok) {
            // Only update local data if save was successful
            currentLesson.last_position = position;
            lastSavedPosition = position;
          } else if (response.status === 401) {
            // Session expired, but don't interrupt video playback
            console.warn("Session expired during position save");
          } else {
            // Other server errors
            console.error(
              "Failed to save position:",
              response.status,
              response.statusText
            );
          }
        } catch (error) {
          console.error("Network error saving position:", error);
          // Could implement retry logic here if needed
        } finally {
          isSavingPosition = false;
        }
      }

      // تحديث الموارد التعليمية
      function updateResources() {
        const resourcesList = document.getElementById("resourcesList");
        const currentLesson = videoLessons[currentVideoIndex];

        resourcesList.innerHTML = "";

        // الموارد الثابتة
        const staticResources = [
          { icon: "fas fa-file-pdf", text: "الاكواد المستخدمة" },
          { icon: "fas fa-code", text: "أمثلة برمجية" },
          { icon: "fas fa-tasks", text: "تمارين عملية" },
        ];

        staticResources.forEach((resource, index) => {
          const item = document.createElement("li");
          item.className = "resource-item";
          const linkText = resource.text;
          const onclickAttr =
            index === 0
              ? `onclick="showCodeModal('${
                  currentLesson.resources_code
                    ? currentLesson.resources_code
                        .replace(/'/g, "\\'")
                        .replace(/\n/g, "\\n")
                        .replace(/\r/g, "")
                    : ""
                }')"`
              : "";
          const hrefAttr =
            index === 1
              ? "examples.html"
              : index === 2
              ? "challenges.html"
              : "#";
          item.innerHTML = `
                    <i class="${resource.icon} resource-icon"></i>
                    <a href="${hrefAttr}" class="resource-link" ${onclickAttr}>${linkText}</a>
                `;
          resourcesList.appendChild(item);
        });
      }

      // عرض الكود في modal
      function showCodeModal(code) {
        if (!code || code.trim() === "") {
          showNotification("لا يوجد كود متاح لهذا الدرس", "info");
          return;
        }

        const modal = document.getElementById("codeModal");
        const codeContent = document.getElementById("codeContent");
        const copyBtn = document.getElementById("copyCodeBtn");

        codeContent.textContent = code;
        modal.style.display = "block";

        // Copy functionality
        copyBtn.onclick = async function () {
          try {
            await navigator.clipboard.writeText(code);
            copyBtn.textContent = "تم النسخ!";
            copyBtn.classList.add("copied");
            setTimeout(() => {
              copyBtn.textContent = "نسخ الكود";
              copyBtn.classList.remove("copied");
            }, 2000);
          } catch (err) {
            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            copyBtn.textContent = "تم النسخ!";
            copyBtn.classList.add("copied");
            setTimeout(() => {
              copyBtn.textContent = "نسخ الكود";
              copyBtn.classList.remove("copied");
            }, 2000);
          }
        };
      }

      // Close modal when clicking the close button or outside the modal
      document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById("codeModal");
        const closeBtn = document.querySelector(".close-modal");

        closeBtn.onclick = function () {
          modal.style.display = "none";
        };

        window.onclick = function (event) {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        };
      });

      // Note: initPage() is called after authentication check in the DOMContentLoaded above
      // No need for duplicate initialization here
    </script>

    <!-- Code Modal -->
    <div id="codeModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>الكود المستخدم في الدرس</h3>
          <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
          <pre id="codeContent"></pre>
          <button id="copyCodeBtn" class="copy-btn">نسخ الكود</button>
        </div>
      </div>
    </div>
  </body>
</html>
