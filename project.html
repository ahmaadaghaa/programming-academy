<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>التكليفات والمشاريع - أكاديمية البرمجة المتكاملة</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* CSS Variables */
      :root {
        --primary: #4361ee;
        --secondary: #3a0ca3;
        --accent: #4cc9f0;
        --success: #4ade80;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #1e293b;
        --light: #f8fafc;
        --gray: #64748b;
        --card-bg: #ffffff;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
        --primary-color: #4e54c8;
        --secondary-color: #8f94fb;
        --accent-color: #ff6b6b;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --text-color: #333;
        --light-color: #f8f9fa;
        --dark-color: #343a40;
      }

      /* Global Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--light-color);
        color: var(--text-color);
        line-height: 1.6;
      }

      .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
      }

      section {
        padding: 80px 0;
      }

      .section-title {
        text-align: center;
        margin-bottom: 50px;
        font-size: 2.5rem;
        color: var(--primary-color);
        position: relative;
      }

      .section-title::after {
        content: "";
        position: absolute;
        bottom: -10px;
        right: 50%;
        transform: translateX(50%);
        width: 100px;
        height: 4px;
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 2px;
      }

      .btn {
        display: inline-block;
        padding: 12px 30px;
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        transition: var(--transition);
        box-shadow: var(--shadow);
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .btn-outline {
        background: transparent;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
      }

      .btn-outline:hover {
        background: var(--primary-color);
        color: white;
      }

      .btn-success {
        background: var(--success-color);
      }

      .btn-warning {
        background: var(--warning-color);
        color: var(--dark-color);
      }

      /* Header & Navbar */
      header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-shadow: var(--shadow);
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo-img {
        width: 50px;
        height: 50px;
        background: linear-gradient(45deg, var(--accent), var(--primary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        animation: rotate 10s linear infinite;
      }

      @keyframes rotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .logo h1 {
        font-size: 1rem;
        white-space: nowrap;
      }

      .nav-links {
        display: flex;
        list-style: none;
        gap: 1.5rem;
      }

      .nav-link {
        color: white;
        text-decoration: none;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        transition: var(--transition);
        position: relative;
      }

      .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .dropdown {
        position: relative;
      }

      .dropdown-menu {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        min-width: 200px;
        box-shadow: var(--shadow);
        border-radius: 8px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: var(--transition);
        z-index: 100;
        padding: 0.5rem 0;
      }

      .dropdown:hover .dropdown-menu {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-menu a {
        display: block;
        padding: 0.8rem 1rem;
        color: var(--dark);
        text-decoration: none;
        border-bottom: 1px solid #eee;
        transition: var(--transition);
      }

      .dropdown-menu a:hover {
        background-color: #f5f5f5;
        color: var(--primary);
      }

      .dropdown-menu a:last-child {
        border-bottom: none;
      }

      .login-btn {
        background-color: var(--accent);
        border-radius: 50px;
        padding: 0.5rem 1.5rem;
      }

      .login-btn:hover {
        background-color: #3ab0d9;
      }

      .mobile-menu-btn {
        display: none;
        flex-direction: column;
        cursor: pointer;
        z-index: 1001;
      }

      .mobile-menu-btn span {
        width: 25px;
        height: 3px;
        background: white;
        margin: 3px 0;
        transition: var(--transition);
      }

      .mobile-menu-btn.active span:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }

      .mobile-menu-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .mobile-menu-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -6px);
      }

      .mobile-menu-overlay {
        position: fixed;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: var(--transition);
      }

      .mobile-menu-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .mobile-nav-links {
        position: fixed;
        top: 0;
        right: -100%;
        width: 80%;
        max-width: 300px;
        height: 100%;
        background: white;
        padding: 2rem;
        overflow-y: auto;
        transition: var(--transition);
        z-index: 1000;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      }

      .mobile-nav-links.active {
        right: 0;
      }

      .mobile-nav-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #eee;
      }

      .mobile-nav-header h2 {
        color: var(--primary);
      }

      .close-mobile-menu {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--dark);
        cursor: pointer;
      }

      .mobile-nav-links ul {
        list-style: none;
      }

      .mobile-nav-links li {
        margin-bottom: 1rem;
      }

      .mobile-nav-links a {
        display: block;
        padding: 0.8rem 1rem;
        color: var(--dark);
        text-decoration: none;
        border-radius: 5px;
        transition: var(--transition);
      }

      .mobile-nav-links a:hover {
        background-color: #f0f4ff;
        color: var(--primary);
      }

      .mobile-dropdown {
        position: relative;
      }

      .mobile-dropdown-toggle {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        padding: 0.8rem 1rem;
        color: var(--dark);
        text-decoration: none;
        border-radius: 5px;
        transition: var(--transition);
      }

      .mobile-dropdown-toggle:hover {
        background-color: #f0f4ff;
        color: var(--primary);
      }

      .mobile-dropdown-menu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        padding-right: 1rem;
      }

      .mobile-dropdown-menu.active {
        max-height: 500px;
      }

      .mobile-dropdown-menu a {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        border-bottom: 1px solid #f0f0f0;
        color: var(--dark);
        text-decoration: none;
        display: block;
      }

      .mobile-dropdown-menu a:last-child {
        border-bottom: none;
      }

      /* User Profile Styles */
      .user-profile {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
      }

      .user-avatar-small {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        border: 2px solid white;
        background-size: cover;
        background-position: center;
        text-indent: -9999px;
        overflow: hidden;
      }

      .user-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        background: white;
        min-width: 200px;
        box-shadow: var(--shadow);
        border-radius: 10px;
        padding: 1rem;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: var(--transition);
        z-index: 1000;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #eee;
        margin-bottom: 0.5rem;
      }

      .user-name {
        font-weight: 600;
        color: var(--dark);
      }

      .user-email {
        font-size: 0.8rem;
        color: var(--gray);
      }

      .logout-btn {
        background: var(--danger);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        cursor: pointer;
        transition: var(--transition);
        width: 100%;
        display: block;
        margin-top: 0.5rem;
        margin-left: 0.5rem;
      }

      .logout-btn:hover {
        background: #dc2626;
      }

      /* Mobile User Profile */
      .user-profile-mobile {
        border-top: 1px solid #eee;
        padding-top: 1.5rem;
        margin-top: 1.5rem;
      }

      .user-info-mobile {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding-bottom: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .user-info-mobile .user-avatar-small {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
      }
      /* Assignments Section */
      .assignments-section {
        padding-top: 150px;
        min-height: 100vh;
      }

      .assignments-container {
        display: grid;
        grid-template-columns: 340px 1fr;
        gap: 30px;
        margin-bottom: 50px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        align-items: start;
      }

      .filters-panel {
        background: white;
        border-radius: 18px;
        box-shadow: var(--shadow);
        padding: 24px;
        position: sticky;
        top: 120px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .filters-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid #f0f0f0;
        padding-bottom: 12px;
      }

      .filters-title {
        font-size: 1.1rem;
        color: var(--primary-color);
        font-weight: 700;
      }

      .filters-hint {
        font-size: 0.85rem;
        color: #666;
      }

      /* Category Selection */
      .category-selection {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        border: 1px solid #eef1f6;
      }

      .category-title {
        font-size: 1.5rem;
        margin-bottom: 25px;
        color: var(--primary-color);
        text-align: center;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }

      .category-options {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .category-option {
        padding: 15px 20px;
        background: #f8f9fa;
        border-radius: 10px;
        cursor: pointer;
        transition: var(--transition);
        border: 2px solid transparent;
      }

      .category-option:hover {
        background: rgba(78, 84, 200, 0.1);
        transform: translateX(-5px);
      }

      .category-option.active {
        background: rgba(78, 84, 200, 0.1);
        border-color: var(--primary-color);
        transform: translateX(-5px);
      }

      .option-title {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--primary-color);
      }

      .option-description {
        font-size: 0.9rem;
        color: #666;
      }

      /* Course Selection */
      .course-selection {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        border: 1px solid #eef1f6;
      }

      .course-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .course-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        cursor: pointer;
        transition: var(--transition);
        border: 2px solid transparent;
      }

      .course-card:hover {
        background: rgba(78, 84, 200, 0.1);
        transform: translateY(-5px);
        border-color: var(--primary-color);
      }

      /* Active course selection effect (mirrors category-option.active) */
      .course-card.active {
        background: rgba(78, 84, 200, 0.1);
        border-color: var(--primary-color);
        transform: translateY(-5px);
      }

      .course-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .course-title {
        font-weight: 600;
        color: var(--primary-color);
        margin: 0;
      }

      .assignment-count {
        background: var(--primary-color);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
      }

      .course-description {
        color: #666;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      /* Assignment Workspace */
      .workspace-panel {
        background: white;
        border-radius: 18px;
        box-shadow: var(--shadow);
        padding: 26px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .workspace-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }

      .workspace-meta {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .meta-pill {
        background: rgba(78, 84, 200, 0.08);
        color: var(--primary-color);
        padding: 8px 14px;
        border-radius: 999px;
        font-size: 0.9rem;
        border: 1px solid rgba(78, 84, 200, 0.2);
      }

      .workspace-title {
        font-size: 1.5rem;
        color: var(--primary-color);
      }

      .difficulty-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .difficulty-badge {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 700;
        border: 1px solid #e9ecef;
        background: #fff;
        color: var(--primary-color);
      }
      .difficulty-badge.diff-easy {
        background: rgba(76, 175, 80, 0.12);
        color: #2e7d32;
        border-color: rgba(76, 175, 80, 0.3);
      }
      .difficulty-badge.diff-medium {
        background: rgba(33, 150, 243, 0.12);
        color: #0d47a1;
        border-color: rgba(33, 150, 243, 0.3);
      }
      .difficulty-badge.diff-hard {
        background: rgba(255, 193, 7, 0.12);
        color: #8a6d1e;
        border-color: rgba(255, 193, 7, 0.3);
      }
      .difficulty-badge.diff-advanced {
        background: rgba(255, 87, 34, 0.12);
        color: #c62828;
        border-color: rgba(255, 87, 34, 0.3);
      }
      .difficulty-badge.diff-expert {
        background: rgba(156, 39, 176, 0.12);
        color: #6a1b9a;
        border-color: rgba(156, 39, 176, 0.3);
      }

      .question-container {
        margin-bottom: 10px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 12px;
        border-right: 4px solid var(--primary-color);
      }

      .question-text {
        font-size: 1.1rem;
        margin-bottom: 15px;
        line-height: 1.6;
      }

      /* Utility */
      .hidden {
        display: none !important;
      }

      .completion-badge {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-right: 8px;
        border: 1px solid #e9ecef;
      }
      .completion-badge.completed {
        background: rgba(76, 175, 80, 0.12);
        color: #2e7d32;
        border-color: rgba(76, 175, 80, 0.3);
      }
      .completion-badge.not-completed {
        background: rgba(255, 193, 7, 0.12);
        color: #8a6d1e;
        border-color: rgba(255, 193, 7, 0.3);
      }

      .question-example {
        background: #e9ecef;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        font-family: monospace;
        font-size: 0.9rem;
      }

      .workspace-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 18px;
      }

      .action-buttons {
        display: flex;
        gap: 12px;
      }

      .action-buttons .btn {
        flex: 1;
      }

      /* AI Assistant */
      .assistant-card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 18px;
        border: 1px solid #e9ecef;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .assistant-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }

      .assistant-avatar {
        width: 40px;
        height: 40px;
        background: var(--primary-color);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        margin-left: 15px;
      }

      .assistant-title {
        font-weight: 600;
        color: var(--primary-color);
      }

      .assistant-messages {
        max-height: 260px;
        overflow-y: auto;
        margin-bottom: 5px;
        padding: 10px;
        background: white;
        border-radius: 8px;
        border: 1px solid #e9ecef;
      }

      .message {
        margin-bottom: 10px;
        padding: 10px 15px;
        border-radius: 8px;
        max-width: 80%;
      }

      .message.user {
        background: rgba(78, 84, 200, 0.1);
        margin-right: auto;
        border-bottom-right-radius: 0;
      }

      .message.assistant {
        background: rgba(255, 107, 107, 0.1);
        margin-left: auto;
        border-bottom-left-radius: 0;
      }

      /* Verdict styling */
      .message.assistant.verdict-yes {
        background: rgba(76, 175, 80, 0.12);
      }
      .message.assistant.verdict-no {
        background: rgba(244, 67, 54, 0.12);
      }

      .assistant-input-container {
        display: flex;
        gap: 10px;
      }

      .assistant-input {
        flex: 1;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        transition: var(--transition);
        background: white;
      }

      .assistant-input:focus {
        border-color: var(--primary-color);
        outline: none;
      }

      .assistant-send {
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        width: 45px;
        cursor: pointer;
        transition: var(--transition);
      }

      .assistant-send:hover {
        background: var(--secondary-color);
      }
      /* Footer */
      footer {
        background: var(--dark);
        color: white;
        padding: 3rem 0 1.5rem;
      }

      .footer-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .footer-column h3 {
        font-size: 1.3rem;
        margin-bottom: 1.5rem;
        position: relative;
        padding-bottom: 0.5rem;
      }

      .footer-column h3::after {
        content: "";
        position: absolute;
        bottom: 0;
        right: 0;
        width: 50px;
        height: 2px;
        background: var(--accent);
      }

      .footer-links {
        list-style: none;
      }

      .footer-links li {
        margin-bottom: 0.8rem;
      }

      .footer-links a {
        color: #cbd5e1;
        text-decoration: none;
        transition: var(--transition);
      }

      .footer-links a:hover {
        color: var(--accent);
        padding-right: 5px;
      }

      .social-links {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
      }

      .social-links a {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        color: white;
        transition: var(--transition);
      }

      .social-links a:hover {
        background: var(--accent);
        transform: translateY(-3px);
      }

      .footer-bottom {
        text-align: center;
        padding-top: 1.5rem;
        border-top: 1px solid #334155;
        color: #94a3b8;
      }
      /* Responsive Styles */
      @media (max-width: 768px) {
        .navbar {
          padding: 1rem;
        }

        .nav-links {
          display: none;
        }

        .mobile-menu-btn {
          display: flex;
        }

        .assignments-section {
          padding-top: 120px;
        }

        .assignments-container {
          grid-template-columns: 1fr;
        }

        .filters-panel {
          position: relative;
          top: 0;
        }

        .workspace-grid {
          grid-template-columns: 1fr;
        }

        .action-buttons {
          flex-direction: column;
        }

        /* Removed projects tabs responsive styles */
      }

      @media (max-width: 576px) {
        .section-title {
          font-size: 2rem;
        }

        .category-selection,
        .workspace-panel {
          padding: 20px;
        }

        .workspace-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }

        .projects-grid {
          grid-template-columns: 1fr;
        }
      }

      @keyframes slideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* Modal Base Styles if not present */
      .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s;
      }

      .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 0;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        animation: slideIn 0.3s;
        overflow: hidden;
      }

      .modal-header {
        padding: 20px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h3 {
        margin: 0;
        font-size: 1.2rem;
      }

      .close-modal {
        color: white;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: var(--transition);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
    </style>
    <script src="login-modal.js"></script>
    <script src="site-notification.js"></script>
  </head>
  <body>
    <!-- Header & Navbar -->
    <header>
      <nav class="navbar">
        <div class="logo">
          <div class="logo-img">
            <i class="fas fa-code"></i>
          </div>
          <h1>أكاديمية البرمجة المتكاملة</h1>
        </div>

        <ul class="nav-links">
          <li><a href="index.html" class="nav-link">الرئيسية</a></li>
          <li class="dropdown">
            <a href="#" class="nav-link"
              >تعلم الآن <i class="fas fa-chevron-down"></i
            ></a>
            <div class="dropdown-menu">
              <a href="examples.html">أمثلة وتطبيقات وشروحات</a>
              <a href="challenges.html">التحديات البرمجية</a>
              <a href="proplemsolving.html">مواقع حل المشاكل البرمجية</a>
            </div>
          </li>
          <li><a href="./roadmap.html" class="nav-link">خارطة الطريق</a></li>
          <li class="dropdown">
            <a href="#" class="nav-link"
              >الكورسات <i class="fas fa-chevron-down"></i
            ></a>
            <div class="dropdown-menu">
              <a href="path.php?path=basics">مسار أساسيات البرمجة</a>
              <a href="path.php?path=frontend">مسار Frontend Developer</a>
              <a href="path.php?path=backend">مسار Backend Developer</a>
            </div>
          </li>
          <li>
            <a href="project.html" class="nav-link">التكليفات والمشاريع</a>
          </li>
          <li class="user-profile" id="userProfile" style="display: none">
            <div class="user-avatar-small" id="userAvatarSmall">م</div>
            <div class="user-dropdown">
              <div class="user-info">
                <div class="user-avatar-small" id="dropdownAvatar">م</div>
                <div>
                  <div class="user-name" id="dropdownUserName"></div>
                  <div class="user-email" id="dropdownUserEmail"></div>
                </div>
              </div>
              <a
                href="profile.html"
                class="nav-link"
                style="
                  display: block;
                  text-align: right;
                  margin-bottom: 0.5rem;
                  color: black;
                  font-size: large;
                "
                ><i
                  class="fas fa-user-circle profile-icon"
                  style="margin-left: 10%"
                ></i
                >الملف الشخصي</a
              >
              <button class="logout-btn" id="logoutBtn">تسجيل الخروج</button>
            </div>
          </li>
          <li id="loginButton">
            <a href="./login1.html" class="nav-link login-btn">تسجيل الدخول</a>
          </li>
        </ul>

        <div class="mobile-menu-btn" id="mobileMenuBtn">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </nav>
    </header>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav-links" id="mobileNavLinks">
      <div class="mobile-nav-header">
        <h2>القائمة</h2>
      </div>
      <ul>
        <li><a href="index.html" class="nav-link">الرئيسية</a></li>
        <li class="mobile-dropdown">
          <div class="mobile-dropdown-toggle">
            <a href="#" class="nav-link">تعلم الآن</a>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="mobile-dropdown-menu">
            <a href="examples.html">أمثلة وتطبيقات وشروحات</a>
            <a href="challenges.html">التحديات البرمجية</a>
            <a href="proplemsolving.html">مواقع حل المشاكل البرمجية</a>
          </div>
        </li>
        <li><a href="./roadmap.html" class="nav-link">خارطة الطريق</a></li>
        <li class="mobile-dropdown">
          <div class="mobile-dropdown-toggle">
            <a href="#" class="nav-link">الكورسات</a>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="mobile-dropdown-menu">
            <a href="path.php?path=basics">مسار أساسيات البرمجة</a>
            <a href="path.php?path=frontend">مسار Frontend Developer</a>
            <a href="path.php?path=backend">مسار Backend Developer</a>
          </div>
        </li>
        <li><a href="project.html" class="nav-link">التكليفات والمشاريع</a></li>
        <li
          class="user-profile-mobile"
          id="userProfileMobile"
          style="display: none"
        >
          <div class="user-info-mobile">
            <div class="user-avatar-small" id="mobileAvatar"></div>
            <div>
              <div class="user-name" id="mobileUserName"></div>
              <div class="user-email" id="mobileUserEmail"></div>
            </div>
          </div>
          <a href="profile.html" class="nav-link">
            <i class="fas fa-user-circle"></i> الملف الشخصي
          </a>
          <button class="logout-btn" id="mobileLogoutBtn">تسجيل الخروج</button>
        </li>
        <li id="loginButtonMobile">
          <a href="./login1.html" class="nav-link login-btn">تسجيل الدخول</a>
        </li>
      </ul>
    </div>
    <!-- Assignments Section -->
    <section class="assignments-section">
      <div class="container">
        <h2 class="section-title">التكليفات والمشاريع</h2>

        <div class="assignments-container">
          <div class="filters-panel">
            <div class="filters-header">
              <div class="filters-title">المسارات والكورسات</div>
              <div class="filters-hint">اختر لتحديث التكليفات</div>
            </div>

            <!-- Category Selection -->
            <div class="category-selection">
              <h3 class="category-title">اختر المسار</h3>

              <div class="category-options">
                <div class="category-option" data-category="basics">
                  <div class="option-title">أساسيات البرمجة</div>
                  <div class="option-description">
                    تمارين في أساسيات البرمجة والخوارزميات
                  </div>
                </div>

                <div class="category-option" data-category="frontend">
                  <div class="option-title">مسار Frontend</div>
                  <div class="option-description">
                    تمارين في تطوير الواجهات الأمامية
                  </div>
                </div>

                <div class="category-option" data-category="backend">
                  <div class="option-title">مسار Backend</div>
                  <div class="option-description">
                    تمارين في تطوير الخوادم والقواعد
                  </div>
                </div>
              </div>
            </div>

            <!-- Course List (appears below when category selected) -->
            <div
              class="course-selection"
              id="courseSelection"
              style="display: none"
            >
              <h3 class="category-title">اختر الكورس</h3>
              <div class="course-grid" id="courseGrid"></div>
            </div>
          </div>

          <!-- Assignment Workspace -->
          <div class="workspace-panel">
            <div class="workspace-header">
              <h3 class="workspace-title" id="workspace-title">
                اختر مساراً ثم كورساً لعرض التكليف
              </h3>
              <div
                id="difficulty-indicator"
                class="difficulty-indicator hidden"
              >
                <span id="difficulty-text" class="difficulty-badge diff-easy"
                  >سهل</span
                >
              </div>
            </div>

            <div class="workspace-meta">
              <span class="meta-pill" id="active-path"
                >المسار: لم يتم التحديد</span
              >
              <span class="meta-pill" id="active-course"
                >الكورس: لم يتم التحديد</span
              >
            </div>

            <div id="question-container" class="question-container hidden">
              <div class="question-text" id="question-text"></div>
              <div
                id="assignment-status"
                class="completion-badge not-completed"
              >
                غير مكتمل
              </div>
            </div>

            <div class="workspace-grid">
              <div class="assistant-card">
                <div class="assistant-header">
                  <div class="assistant-avatar">
                    <i class="fas fa-robot"></i>
                  </div>
                  <div class="assistant-title">المساعد الذكي</div>
                </div>

                <div class="assistant-messages" id="assistant-messages">
                  <div class="message assistant">
                    اكتب كودك هنا وسأقوم بتحليله وإخبارك إذا كان صحيحاً أم لا.
                  </div>
                </div>

                <div class="assistant-input-container">
                  <textarea
                    class="assistant-input"
                    id="assistant-input"
                    placeholder="ألصق الكود للتحليل..."
                    rows="6"
                  ></textarea>
                  <button class="assistant-send" id="assistant-send">
                    <i class="fas fa-paper-plane"></i>
                  </button>
                </div>

                <div class="action-buttons">
                  <button class="btn btn-outline" id="hint-btn">
                    طلب مساعدة كاملة
                  </button>
                  <button class="btn btn-warning" id="next-btn">
                    السؤال التالي
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-column">
            <h3>عن الأكاديمية</h3>
            <p>
              نحن منصة تعليمية تهدف إلى تمكين الشباب العربي من تعلم البرمجة
              وتطوير مهاراتهم التقنية لسوق العمل.
            </p>
            <div class="social-links">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-youtube"></i></a>
            </div>
          </div>

          <div class="footer-column">
            <h3>روابط سريعة</h3>
            <ul class="footer-links">
              <li><a href="index.html">الصفحة الرئيسية</a></li>
              <li><a href="#">من نحن</a></li>
              <li><a href="path.php">الكورسات</a></li>
              <li><a href="#">المشاريع</a></li>
              <li><a href="#">اتصل بنا</a></li>
            </ul>
          </div>

          <div class="footer-column">
            <h3>الكورسات</h3>
            <ul class="footer-links">
              <li><a href="path.php?path=basics">أساسيات البرمجة</a></li>
              <li>
                <a href="path.php?path=frontend">تطوير الواجهات الأمامية</a>
              </li>
              <li>
                <a href="path.php?path=backend">تطوير الواجهات الخلفية</a>
              </li>
              <li><a href="#">تطوير تطبيقات الجوال</a></li>
              <li><a href="#">علوم البيانات</a></li>
            </ul>
          </div>

          <div class="footer-column">
            <h3>اتصل بنا</h3>
            <ul class="footer-links">
              <li><i class="fas fa-map-marker-alt"></i> دمشق، سوريا</li>
              <li><i class="fas fa-phone"></i> +963 123 456 789</li>
              <li>
                <i class="fas fa-envelope"></i> info@programmingacademy.com
              </li>
            </ul>
          </div>
        </div>

        <div class="footer-bottom">
          <p>جميع الحقوق محفوظة &copy; 2023 أكاديمية البرمجة المتكاملة</p>
        </div>
      </div>
    </footer>

    <script>
      // Mobile Menu Toggle
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const mobileMenuOverlay = document.getElementById("mobileMenuOverlay");
      const mobileNavLinks = document.getElementById("mobileNavLinks");

      function toggleMobileMenu() {
        const isActive = mobileMenuBtn.classList.contains("active");
        if (isActive) {
          closeMobileMenuFunc();
        } else {
          openMobileMenu();
        }
      }

      function openMobileMenu() {
        mobileMenuBtn.classList.add("active");
        mobileMenuOverlay.classList.add("active");
        mobileNavLinks.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeMobileMenuFunc() {
        mobileMenuBtn.classList.remove("active");
        mobileMenuOverlay.classList.remove("active");
        mobileNavLinks.classList.remove("active");
        document.body.style.overflow = "auto";
      }

      mobileMenuBtn.addEventListener("click", toggleMobileMenu);
      mobileMenuOverlay.addEventListener("click", closeMobileMenuFunc);

      // Mobile Dropdown Toggle
      document.querySelectorAll(".mobile-dropdown-toggle").forEach((toggle) => {
        toggle.addEventListener("click", function (e) {
          e.preventDefault();
          const menu = this.nextElementSibling;
          const icon = this.querySelector("i");
          menu.classList.toggle("active");
          if (menu.classList.contains("active")) {
            icon.classList.remove("fa-chevron-down");
            icon.classList.add("fa-chevron-up");
          } else {
            icon.classList.remove("fa-chevron-up");
            icon.classList.add("fa-chevron-down");
          }
        });
      });

      // User Interface Update
      function updateUserInterface() {
        const currentUser = window.currentUser;
        const userProfile = document.getElementById("userProfile");
        const loginButton = document.getElementById("loginButton");
        const userProfileMobile = document.getElementById("userProfileMobile");
        const loginButtonMobile = document.getElementById("loginButtonMobile");

        if (currentUser) {
          // Show user profile, hide login
          userProfile.style.display = "flex";
          loginButton.style.display = "none";
          userProfileMobile.style.display = "block";
          loginButtonMobile.style.display = "none";

          // Set user info
          const initial = currentUser.firstName
            ? currentUser.firstName.charAt(0)
            : currentUser.username
            ? currentUser.username.charAt(0)
            : "?";

          const fullName =
            currentUser.firstName && currentUser.lastName
              ? `${currentUser.firstName} ${currentUser.lastName}`
              : currentUser.username;

          const email = currentUser.email || currentUser.username;

          // Desktop
          document.getElementById("dropdownUserName").textContent = fullName;
          document.getElementById("dropdownUserEmail").textContent = email;

          // Mobile
          document.getElementById("mobileUserName").textContent = fullName;
          document.getElementById("mobileUserEmail").textContent = email;

          // Avatar
          const avatars = ["userAvatarSmall", "dropdownAvatar", "mobileAvatar"];
          avatars.forEach((id) => {
            const avatar = document.getElementById(id);
            if (
              currentUser.avatar &&
              currentUser.avatar.startsWith("data:image")
            ) {
              avatar.style.background = `url('${currentUser.avatar}') no-repeat center center / cover`;
              avatar.textContent = "";
            } else {
              avatar.textContent = initial;
              avatar.style.background =
                "linear-gradient(135deg, var(--accent), var(--primary))";
              avatar.style.backgroundImage = "none";
            }
          });
        } else {
          // Hide user profile, show login
          userProfile.style.display = "none";
          loginButton.style.display = "block";
          userProfileMobile.style.display = "none";
          loginButtonMobile.style.display = "block";
        }
      }

      // Logout
      document
        .getElementById("logoutBtn")
        .addEventListener("click", function () {
          fetch("logout.php")
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                window.currentUser = null;
                updateUserInterface();
                showNotification("تم تسجيل الخروج بنجاح!", "success");
              } else {
                showNotification("خطأ في تسجيل الخروج", "error");
              }
            })
            .catch((error) => {
              console.error("Logout error:", error);
              showNotification("خطأ في تسجيل الخروج", "error");
            });
        });

      document
        .getElementById("mobileLogoutBtn")
        .addEventListener("click", function () {
          closeMobileMenuFunc(); // Close menu first
          fetch("logout.php")
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                window.currentUser = null;
                updateUserInterface();
                showNotification("تم تسجيل الخروج بنجاح!", "success");
              } else {
                showNotification("خطأ في تسجيل الخروج", "error");
              }
            })
            .catch((error) => {
              console.error("Logout error:", error);
              showNotification("خطأ في تسجيل الخروج", "error");
            });
        });

      // Dropdown hover functionality
      const userProfile = document.getElementById("userProfile");
      const userDropdown = document.querySelector(".user-dropdown");
      let dropdownTimeout;

      function showDropdown() {
        clearTimeout(dropdownTimeout);
        if (userDropdown) {
          userDropdown.style.opacity = "1";
          userDropdown.style.visibility = "visible";
          userDropdown.style.transform = "translateY(0)";
        }
      }

      function hideDropdown() {
        dropdownTimeout = setTimeout(() => {
          if (userDropdown) {
            userDropdown.style.opacity = "0";
            userDropdown.style.visibility = "hidden";
            userDropdown.style.transform = "translateY(0)";
          }
        }, 150); // Small delay to allow moving between elements
      }

      if (userProfile) {
        userProfile.addEventListener("mouseenter", showDropdown);
        userProfile.addEventListener("mouseleave", hideDropdown);
      }

      if (userDropdown) {
        userDropdown.addEventListener("mouseenter", showDropdown);
        userDropdown.addEventListener("mouseleave", hideDropdown);
      }

      // Category Selection
      const categoryOptions = document.querySelectorAll(".category-option");
      const activePathLabel = document.getElementById("active-path");
      const activeCourseLabel = document.getElementById("active-course");

      categoryOptions.forEach((option) => {
        option.addEventListener("click", function () {
          // Update active category
          categoryOptions.forEach((opt) => opt.classList.remove("active"));
          this.classList.add("active");

          // Load courses for this category
          const category = this.dataset.category;
          currentCourse = null;
          updateActiveCourseLabel();
          updateActivePathLabel(category);
          document.getElementById(
            "workspace-title"
          ).textContent = `تكليفات ${getCourseName(category)}`;
          loadCoursesForCategory(category);

          // Hide question container until a course is selected
          const qc = document.getElementById("question-container");
          if (qc) qc.classList.add("hidden");

          // Hide difficulty indicator until a course is selected
          const di = document.getElementById("difficulty-indicator");
          if (di) di.classList.add("hidden");
        });
      });

      function updateActivePathLabel(category) {
        if (category) {
          activePathLabel.textContent = `المسار: ${getCourseName(category)}`;
        } else {
          activePathLabel.textContent = "المسار: لم يتم التحديد";
        }
      }

      function updateActiveCourseLabel(title) {
        activeCourseLabel.textContent = title
          ? `الكورس: ${title}`
          : "الكورس: لم يتم التحديد";
      }

      // Project Tabs
      // Projects UI removed

      // Update Workspace Function
      function updateWorkspace() {
        const activeCourse = document.querySelector(".category-option.active");
        const course = activeCourse ? activeCourse.dataset.category : null;
        document.getElementById("workspace-title").textContent = course
          ? `تكليفات ${getCourseName(course)}`
          : "اختر مساراً ثم كورساً لعرض التكليف";
        updateActivePathLabel(course);
        updateActiveCourseLabel();
        loadQuestion(currentCourse);
      }

      // Get Course Name
      function getCourseName(course) {
        if (!course) return "لم يتم التحديد";
        const courses = {
          basics: "أساسيات البرمجة",
          frontend: "مسار Frontend",
          backend: "مسار Backend",
        };
        return courses[course] || course;
      }

      // Question Bank - now loaded from API
      let questionBank = {};
      let currentQuestionIndex = 0;
      let currentCourse = null;
      let currentCategory = null;

      // Load courses for category
      async function loadCoursesForCategory(category) {
        currentCategory = category;
        try {
          const response = await fetch(
            `fetch_courses_with_assignments.php?category=${category}`
          );
          const data = await response.json();
          if (data.success) {
            displayCourses(data.courses);
            document.getElementById("courseSelection").style.display = "block";
          } else {
            console.error("Failed to load courses:", data.message);
            document.getElementById("courseSelection").style.display = "none";
          }
        } catch (error) {
          console.error("Error loading courses:", error);
          document.getElementById("courseSelection").style.display = "none";
        }
      }

      // Display courses in grid
      function displayCourses(courses) {
        const grid = document.getElementById("courseGrid");
        grid.innerHTML = "";

        courses.forEach((course) => {
          const card = document.createElement("div");
          card.className = "course-card";
          card.onclick = () => selectCourse(course.id, course.title, card);
          card.innerHTML = `
            <div class="course-header">
              <h4 class="course-title">${course.title}</h4>
              <span class="assignment-count">${
                course.assignment_count
              } تكليف</span>
            </div>
            <div class="course-description">${course.description || ""}</div>
          `;
          grid.appendChild(card);
        });
      }

      // Select course and load assignments
      function selectCourse(courseId, courseTitle, cardEl) {
        // Check if user is logged in
        if (!window.currentUser) {
          showLoginModal({
            message: "يجب عليك تسجيل الدخول للوصول إلى التكليفات والمشاريع.",
          });
          return;
        }

        currentCourse = courseId;
        document.getElementById(
          "workspace-title"
        ).textContent = `تكليفات ${courseTitle}`;
        updateActiveCourseLabel(courseTitle);

        // Apply active effect: clear previous and set on clicked
        const cards = document.querySelectorAll(".course-card");
        cards.forEach((c) => c.classList.remove("active"));
        if (cardEl) {
          cardEl.classList.add("active");
        }

        loadQuestion(courseId);

        // Show question container now that a course is selected
        const qc = document.getElementById("question-container");
        if (qc) qc.classList.remove("hidden");

        // Show difficulty indicator now that a course is selected
        const di = document.getElementById("difficulty-indicator");
        if (di) di.classList.remove("hidden");
      }

      // Load Question Function
      async function loadQuestion(courseId) {
        if (!courseId) {
          document.getElementById("question-text").textContent =
            "اختر كورساً لعرض التكليفات.";
          return;
        }

        if (!questionBank[courseId]) {
          try {
            const response = await fetch(
              `fetch_assignments.php?course=${courseId}`
            );
            const data = await response.json();
            if (data.success) {
              questionBank[courseId] = data.assignments;
            } else {
              console.error("Failed to load assignments:", data.message);
              return;
            }
          } catch (error) {
            console.error("Error loading assignments:", error);
            return;
          }
        }

        const questions = questionBank[courseId];
        if (questions && questions.length > 0) {
          const question = questions[currentQuestionIndex % questions.length];
          document.getElementById("question-text").textContent =
            question.question;

          // Update difficulty indicator (text + color)
          const diffEl = document.getElementById("difficulty-text");
          if (diffEl) {
            const d = parseInt(question.difficulty || 1, 10);
            let label = "سهل";
            let cls = "diff-easy";
            switch (d) {
              case 2:
                label = "متوسط";
                cls = "diff-medium";
                break;
              case 3:
                label = "صعب";
                cls = "diff-hard";
                break;
              case 4:
                label = "متقدم";
                cls = "diff-advanced";
                break;
              case 5:
                label = "خبير";
                cls = "diff-expert";
                break;
              default:
                label = "سهل";
                cls = "diff-easy";
                break;
            }
            diffEl.textContent = label;
            diffEl.className = `difficulty-badge ${cls}`;
          }

          // Update completion badge
          const statusEl = document.getElementById("assignment-status");
          if (statusEl) {
            statusEl.classList.remove("completed", "not-completed");
            if (parseInt(question.completed || 0, 10) === 1) {
              statusEl.textContent = "مكتمل";
              statusEl.classList.add("completed");
            } else {
              statusEl.textContent = "غير مكتمل";
              statusEl.classList.add("not-completed");
            }
          }
        }
      }

      // Manual submit removed; AI verdict controls completion dynamically
      // Next Question
      document
        .getElementById("next-btn")
        .addEventListener("click", function () {
          if (!currentCourse) {
            addAssistantMessage("يرجى اختيار كورس أولاً.", "assistant");
            return;
          }
          currentQuestionIndex++;
          loadQuestion(currentCourse);
          addAssistantMessage("تم تحميل سؤال جديد. حظاً موفقاً!", "assistant");
        });

      // Full Help Button - request AI to fix or generate code
      document
        .getElementById("hint-btn")
        .addEventListener("click", async function () {
          if (!currentCourse) {
            addAssistantMessage("يرجى اختيار كورس أولاً.", "assistant");
            return;
          }

          const questions = questionBank[currentCourse];
          if (!questions || questions.length === 0) {
            addAssistantMessage("لا توجد تكليفات محملة.", "assistant");
            return;
          }

          const currentQuestion =
            questions[currentQuestionIndex % questions.length];
          addAssistantMessage(
            "جارٍ طلب مساعدة كاملة (إصلاح/توليد الكود)...",
            "assistant"
          );

          try {
            const currentCode = assistantInput.value.trim();
            const resp = await fetch("ai_helper_projects.php", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                mode: "fix",
                question: currentQuestion.question,
                course_id: currentCourse,
                code: currentCode || undefined,
              }),
            });
            const data = await resp.json();
            if (data.success) {
              if (data.fixed_code) {
                assistantInput.value = data.fixed_code;
              }
              addAssistantMessage(
                data.ai_response || "تم إصلاح/توليد الكود.",
                "assistant"
              );
            } else {
              addAssistantMessage(
                data.message || "تعذر الحصول على مساعدة كاملة.",
                "assistant"
              );
            }
          } catch (err) {
            console.error(err);
            addAssistantMessage(
              "حدث خطأ أثناء طلب المساعدة الكاملة.",
              "assistant"
            );
          }
        });

      // AI Assistant
      const assistantMessages = document.getElementById("assistant-messages");
      const assistantInput = document.getElementById("assistant-input");
      const assistantSend = document.getElementById("assistant-send");

      function addAssistantMessage(text, sender, opts = {}) {
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message", sender);
        if (opts && opts.verdict) {
          messageDiv.classList.add(`verdict-${opts.verdict}`);
        }
        messageDiv.textContent = text;
        assistantMessages.appendChild(messageDiv);
        assistantMessages.scrollTop = assistantMessages.scrollHeight;
      }

      assistantSend.addEventListener("click", function () {
        sendMessage();
      });

      assistantInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          sendMessage();
        }
      });

      function sendMessage() {
        const code = assistantInput.value.trim();
        if (code === "") return;

        addAssistantMessage(code, "user");
        assistantInput.value = "";

        // Analyze code
        analyzeCode(code);
      }

      async function analyzeCode(code) {
        if (!currentCourse) {
          addAssistantMessage("يرجى اختيار كورس أولاً.", "assistant");
          return;
        }

        const questions = questionBank[currentCourse];
        if (!questions || questions.length === 0) {
          addAssistantMessage("لا توجد تكليفات محملة.", "assistant");
          return;
        }

        const currentQuestion =
          questions[currentQuestionIndex % questions.length];

        addAssistantMessage("جارٍ التحليل عبر المساعد الفعلي...", "assistant");

        try {
          const response = await fetch("ai_helper_projects.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              question: currentQuestion.question,
              code,
              course_id: currentCourse,
              assignment_id: currentQuestion.id,
            }),
          });

          const data = await response.json();
          if (data.success) {
            if (data.verdict) {
              addAssistantMessage(data.ai_response, "assistant", {
                verdict: data.verdict,
              });
            } else {
              addAssistantMessage(data.ai_response, "assistant");
            }

            // On successful completion update, refresh badge from backend
            if (data.verdict === "yes" || data.updated_completion) {
              try {
                const refresh = await fetch(
                  `fetch_assignments.php?course=${currentCourse}`
                );
                const refreshed = await refresh.json();
                if (refreshed.success) {
                  questionBank[currentCourse] = refreshed.assignments;
                  const q =
                    questionBank[currentCourse][
                      currentQuestionIndex % questionBank[currentCourse].length
                    ];
                  const statusEl = document.getElementById("assignment-status");
                  if (statusEl) {
                    statusEl.classList.remove("completed", "not-completed");
                    if (parseInt(q.completed || 0, 10) === 1) {
                      statusEl.textContent = "مكتمل";
                      statusEl.classList.add("completed");
                    } else {
                      statusEl.textContent = "غير مكتمل";
                      statusEl.classList.add("not-completed");
                    }
                  }
                }
              } catch (e) {
                // ignore refresh error
              }
            }
          } else {
            addAssistantMessage(
              data.message || "تعذر الحصول على رد من المساعد.",
              "assistant"
            );
          }
        } catch (error) {
          console.error("AI helper error:", error);
          addAssistantMessage("حدث خطأ أثناء الاتصال بالمساعد.", "assistant");
        }
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        // Fetch user status first
        fetch("user_status.php", { credentials: "same-origin" })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            if (data.success && data.user) {
              window.currentUser = data.user;
              updateUserInterface();
            } else {
              window.currentUser = null;
              updateUserInterface();
              // Show login modal - page requires authentication
              setTimeout(function () {
                if (typeof showLoginModal === "function") {
                  showLoginModal({
                    message:
                      "يجب عليك تسجيل الدخول للوصول إلى التكليفات والمشاريع.",
                  });
                }
              }, 100);
            }
          })
          .catch((error) => {
            console.error("Error fetching user status:", error);
            window.currentUser = null;
            updateUserInterface();
            // Show login modal on error
            setTimeout(function () {
              if (typeof showLoginModal === "function") {
                showLoginModal({
                  message:
                    "يجب عليك تسجيل الدخول للوصول إلى التكليفات والمشاريع.",
                });
              }
            }, 100);
          });

        updateActivePathLabel();
        updateActiveCourseLabel();
        const courseList = document.getElementById("courseSelection");
        if (courseList) courseList.style.display = "none";
        const qc = document.getElementById("question-container");
        if (qc) qc.classList.add("hidden");
        const di = document.getElementById("difficulty-indicator");
        if (di) di.classList.add("hidden");
        addAssistantMessage(
          "اختر مساراً ثم كورساً لبدء حل التكليفات. سأقوم بتحليل الكود وإخبارك إذا كان صحيحاً.",
          "assistant"
        );
      });
    </script>
  </body>
</html>
