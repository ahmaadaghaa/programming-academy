<!-- admin_platforms.html - Simple admin interface for managing platforms -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>إدارة منصات حل المشاكل - لوحة الإدارة</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #4361ee;
        --secondary: #3a0ca3;
        --success: #4ade80;
        --danger: #ef4444;
        --warning: #f59e0b;
        --gray: #64748b;
        --light: #f8fafc;
        --dark: #1e293b;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--light);
        color: var(--dark);
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        text-align: center;
      }

      .nav-tabs {
        display: flex;
        background: white;
        border-radius: 10px;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .nav-tab {
        flex: 1;
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        border-bottom: 3px solid transparent;
      }

      .nav-tab:hover {
        background: #f8fafc;
      }

      .nav-tab.active {
        background: var(--primary);
        color: white;
        border-bottom-color: var(--primary);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .add-platform-btn {
        background: var(--success);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 10px;
        font-size: 1.1rem;
        cursor: pointer;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
      }

      .add-platform-btn:hover {
        background: #22c55e;
        transform: translateY(-2px);
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .modal-content {
        background: white;
        margin: 5% auto;
        padding: 2rem;
        border-radius: 15px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--dark);
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.8rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--primary);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .features-input {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }

      .features-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .feature-tag {
        background: var(--primary);
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .feature-tag .remove {
        cursor: pointer;
        font-weight: bold;
      }

      .btn-group {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        margin-top: 2rem;
      }

      .btn {
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-secondary {
        background: var(--gray);
        color: white;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .platforms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .platform-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
      }

      .platform-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
      }

      .platform-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--dark);
      }

      .platform-status {
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .status-active {
        background: var(--success);
        color: white;
      }

      .status-inactive {
        background: var(--danger);
        color: white;
      }

      .platform-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        color: var(--gray);
      }

      .platform-actions {
        display: flex;
        gap: 0.5rem;
      }

      .action-btn {
        padding: 0.5rem;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }

      .edit-btn {
        background: var(--warning);
        color: white;
      }

      .delete-btn {
        background: var(--danger);
        color: white;
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem;
        border-radius: 8px;
        color: white;
        z-index: 1001;
        display: none;
        max-width: 400px;
      }

      .notification.success {
        background: var(--success);
      }

      .notification.error {
        background: var(--danger);
      }

      .close-modal {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray);
      }

      .checkbox-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        font-weight: normal;
      }

      .checkbox-label input[type="checkbox"] {
        width: auto;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-cogs"></i> لوحة إدارة الأكاديمية</h1>
        <p>إدارة المنصات والأمثلة البرمجية</p>
      </div>

      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <div class="nav-tab active" data-tab="platforms">
          <i class="fas fa-code"></i> المنصات
        </div>
        <div class="nav-tab" data-tab="examples">
          <i class="fas fa-lightbulb"></i> الأمثلة
        </div>
      </div>

      <!-- Platforms Section -->
      <div class="tab-content active" id="platformsTab">
        <button class="add-platform-btn" onclick="openAddModal()">
          <i class="fas fa-plus"></i> إضافة منصة جديدة
        </button>

        <div class="platforms-grid" id="platformsGrid">
          <!-- Platforms will be loaded here -->
        </div>
      </div>

      <!-- Examples Section -->
      <div class="tab-content" id="examplesTab">
        <button class="add-platform-btn" onclick="openAddExampleModal()">
          <i class="fas fa-plus"></i> إضافة مثال جديد
        </button>

        <div class="platforms-grid" id="examplesGrid">
          <!-- Examples will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal" id="platformModal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal()">&times;</button>
        <h2 id="modalTitle">إضافة منصة جديدة</h2>

        <form id="platformForm">
          <input type="hidden" id="platformId" name="id" />

          <div class="form-group">
            <label for="name">اسم المنصة *</label>
            <input type="text" id="name" name="name" required />
          </div>

          <div class="form-group">
            <label for="description">الوصف *</label>
            <textarea id="description" name="description" required></textarea>
          </div>

          <div class="form-group">
            <label for="url">رابط المنصة *</label>
            <input type="url" id="url" name="url" required />
          </div>

          <div class="form-group">
            <label for="category">الفئة *</label>
            <select id="category" name="category" required>
              <option value="global">عالمية</option>
              <option value="arabic">عربية</option>
            </select>
          </div>

          <div class="form-group">
            <label for="level">المستوى *</label>
            <select id="level" name="level" required>
              <option value="beginner">مبتدئ</option>
              <option value="intermediate">متوسط</option>
              <option value="advanced">متقدم</option>
            </select>
          </div>

          <div class="form-group">
            <label for="language">اللغة *</label>
            <select id="language" name="language" required>
              <option value="english">إنجليزي</option>
              <option value="arabic">عربي</option>
              <option value="both">كلا اللغتين</option>
            </select>
          </div>

          <div class="form-group">
            <label for="user_count">عدد المستخدمين</label>
            <input type="number" id="user_count" name="user_count" min="0" />
          </div>

          <div class="form-group">
            <label for="problem_count">عدد المشاكل</label>
            <input
              type="number"
              id="problem_count"
              name="problem_count"
              min="0"
            />
          </div>

          <div class="form-group">
            <label>الميزات</label>
            <div class="features-input">
              <input type="text" id="featureInput" placeholder="أضف ميزة..." />
              <button
                type="button"
                onclick="addFeature()"
                class="btn btn-primary"
              >
                إضافة
              </button>
            </div>
            <div class="features-list" id="featuresList"></div>
          </div>

          <div class="form-group">
            <label for="logo_url">رابط الشعار</label>
            <input type="url" id="logo_url" name="logo_url" />
          </div>

          <div class="btn-group">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal()"
            >
              إلغاء
            </button>
            <button type="submit" class="btn btn-primary">حفظ</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add/Edit Example Modal -->
    <div class="modal" id="exampleModal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeExampleModal()">
          &times;
        </button>
        <h2 id="exampleModalTitle">إضافة مثال جديد</h2>

        <form id="exampleForm">
          <input type="hidden" id="exampleId" name="id" />

          <div class="form-group">
            <label for="exampleTitle">عنوان المثال *</label>
            <input type="text" id="exampleTitle" name="title" required />
          </div>

          <div class="form-group">
            <label for="exampleDescription">الوصف *</label>
            <textarea
              id="exampleDescription"
              name="description"
              required
            ></textarea>
          </div>

          <div class="form-group">
            <label for="exampleCategory">الفئة *</label>
            <select id="exampleCategory" name="category" required>
              <option value="frontend">Frontend</option>
              <option value="backend">Backend</option>
              <option value="mobile">تطبيقات الجوال</option>
              <option value="algorithms">الخوارزميات</option>
            </select>
          </div>

          <div class="form-group">
            <label for="exampleDifficulty">المستوى *</label>
            <select id="exampleDifficulty" name="difficulty" required>
              <option value="beginner">مبتدئ</option>
              <option value="intermediate">متوسط</option>
              <option value="advanced">متقدم</option>
            </select>
          </div>

          <div class="form-group">
            <label for="exampleCodeLanguage">لغة البرمجة *</label>
            <input
              type="text"
              id="exampleCodeLanguage"
              name="code_language"
              required
              placeholder="مثال: javascript, python, php"
            />
          </div>

          <div class="form-group">
            <label for="exampleCodeSnippet">كود المثال *</label>
            <textarea
              id="exampleCodeSnippet"
              name="code_snippet"
              required
              placeholder="ألصق كود المثال هنا"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="exampleImageUrl">رابط الصورة</label>
            <input
              type="url"
              id="exampleImageUrl"
              name="image_url"
              placeholder="رابط صورة توضيحية للمثال"
            />
          </div>

          <div class="form-group">
            <label for="exampleDemoUrl">رابط العرض التوضيحي</label>
            <input
              type="url"
              id="exampleDemoUrl"
              name="demo_url"
              placeholder="رابط للعرض التوضيحي (اختياري)"
            />
          </div>

          <div class="form-group">
            <label>التقنيات المستخدمة</label>
            <div class="features-input">
              <input type="text" id="techInput" placeholder="أضف تقنية..." />
              <button
                type="button"
                onclick="addTechnology()"
                class="btn btn-primary"
              >
                إضافة
              </button>
            </div>
            <div class="features-list" id="techList"></div>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                id="requiresSpecialEnv"
                name="requires_special_env"
                onchange="toggleSpecialEnvMessage()"
              />
              يحتاج إلى بيئة تشغيل خاصة
            </label>
          </div>

          <div class="form-group" id="specialEnvGroup" style="display: none">
            <label for="specialEnvMessage">رسالة البيئة الخاصة *</label>
            <textarea
              id="specialEnvMessage"
              name="special_env_message"
              placeholder="شرح البيئة المطلوبة لتشغيل هذا المثال"
            ></textarea>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                id="exampleIsActive"
                name="is_active"
                checked
              />
              نشط (مرئي للمستخدمين)
            </label>
          </div>

          <div class="btn-group">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeExampleModal()"
            >
              إلغاء
            </button>
            <button type="submit" class="btn btn-primary">حفظ</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
      let currentFeatures = [];
      let currentTechnologies = [];

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadPlatforms();
        setupTabSwitching();
      });

      // Setup tab switching
      function setupTabSwitching() {
        const tabs = document.querySelectorAll(".nav-tab");
        tabs.forEach((tab) => {
          tab.addEventListener("click", function () {
            const tabName = this.getAttribute("data-tab");

            // Remove active class from all tabs
            document
              .querySelectorAll(".nav-tab")
              .forEach((t) => t.classList.remove("active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.remove("active"));

            // Add active class to clicked tab
            this.classList.add("active");
            document.getElementById(tabName + "Tab").classList.add("active");

            // Load content based on tab
            if (tabName === "examples") {
              loadExamples();
            }
          });
        });
      }

      // Load all platforms
      async function loadPlatforms() {
        try {
          const response = await fetch("admin_platforms.php");
          const data = await response.json();

          if (data.success) {
            displayPlatforms(data.platforms);
          } else {
            showNotification(data.message || "فشل في تحميل المنصات", "error");
          }
        } catch (error) {
          console.error("Error loading platforms:", error);
          showNotification("حدث خطأ في الاتصال", "error");
        }
      }

      // Display platforms in grid
      function displayPlatforms(platforms) {
        const grid = document.getElementById("platformsGrid");
        grid.innerHTML = "";

        platforms.forEach((platform) => {
          const card = document.createElement("div");
          card.className = "platform-card";
          card.innerHTML = `
                    <div class="platform-header">
                        <h3 class="platform-title">${platform.name}</h3>
                        <span class="platform-status ${
                          platform.is_active
                            ? "status-active"
                            : "status-inactive"
                        }">
                            ${platform.is_active ? "نشط" : "غير نشط"}
                        </span>
                    </div>
                    <div class="platform-stats">
                        <div><i class="fas fa-users"></i> ${formatNumber(
                          platform.user_count
                        )}</div>
                        <div><i class="fas fa-code"></i> ${formatNumber(
                          platform.problem_count
                        )}</div>
                        <div><i class="fas fa-star"></i> ${parseFloat(
                          platform.rating
                        ).toFixed(1)}</div>
                        <div><i class="fas fa-globe"></i> ${
                          platform.category === "global" ? "عالمي" : "عربي"
                        }</div>
                    </div>
                    <div class="platform-actions">
                        <button class="action-btn edit-btn" onclick="editPlatform(${
                          platform.id
                        })">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button class="action-btn delete-btn" onclick="deletePlatform(${
                          platform.id
                        })">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
          grid.appendChild(card);
        });
      }

      // Open add modal
      function openAddModal() {
        document.getElementById("modalTitle").textContent = "إضافة منصة جديدة";
        document.getElementById("platformForm").reset();
        document.getElementById("platformId").value = "";
        currentFeatures = [];
        updateFeaturesDisplay();
        document.getElementById("platformModal").style.display = "block";
      }

      // Edit platform
      async function editPlatform(id) {
        try {
          const response = await fetch(`admin_platforms.php?id=${id}`);
          const data = await response.json();

          if (data.success) {
            const platform = data.platform;
            document.getElementById("modalTitle").textContent = "تعديل المنصة";
            document.getElementById("platformId").value = platform.id;
            document.getElementById("name").value = platform.name;
            document.getElementById("description").value = platform.description;
            document.getElementById("url").value = platform.url;
            document.getElementById("category").value = platform.category;
            document.getElementById("level").value = platform.level;
            document.getElementById("language").value = platform.language;
            document.getElementById("user_count").value = platform.user_count;
            document.getElementById("problem_count").value =
              platform.problem_count;
            document.getElementById("logo_url").value = platform.logo_url;

            currentFeatures = platform.features || [];
            updateFeaturesDisplay();

            document.getElementById("platformModal").style.display = "block";
          } else {
            showNotification(
              data.message || "فشل في تحميل بيانات المنصة",
              "error"
            );
          }
        } catch (error) {
          console.error("Error loading platform:", error);
          showNotification("حدث خطأ في الاتصال", "error");
        }
      }

      // Delete platform
      async function deletePlatform(id) {
        if (!confirm("هل أنت متأكد من حذف هذه المنصة؟")) {
          return;
        }

        try {
          const response = await fetch(`admin_platforms.php?id=${id}`, {
            method: "DELETE",
          });
          const data = await response.json();

          if (data.success) {
            showNotification("تم حذف المنصة بنجاح", "success");
            loadPlatforms(); // Reload the list
          } else {
            showNotification(data.message || "فشل في حذف المنصة", "error");
          }
        } catch (error) {
          console.error("Error deleting platform:", error);
          showNotification("حدث خطأ في الاتصال", "error");
        }
      }

      // Handle form submission
      document
        .getElementById("platformForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const data = Object.fromEntries(formData);
          data.features = currentFeatures;

          const isEdit = data.id;
          const method = isEdit ? "PUT" : "POST";

          try {
            const response = await fetch("admin_platforms.php", {
              method: method,
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });

            const result = await response.json();

            if (result.success) {
              showNotification(
                isEdit ? "تم تحديث المنصة بنجاح" : "تم إضافة المنصة بنجاح",
                "success"
              );
              closeModal();
              loadPlatforms(); // Reload the list
            } else {
              showNotification(result.message || "فشل في حفظ المنصة", "error");
            }
          } catch (error) {
            console.error("Error saving platform:", error);
            showNotification("حدث خطأ في الاتصال", "error");
          }
        });

      // Add feature
      function addFeature() {
        const input = document.getElementById("featureInput");
        const feature = input.value.trim();

        if (feature && !currentFeatures.includes(feature)) {
          currentFeatures.push(feature);
          updateFeaturesDisplay();
          input.value = "";
        }
      }

      // Update features display
      function updateFeaturesDisplay() {
        const list = document.getElementById("featuresList");
        list.innerHTML = "";

        currentFeatures.forEach((feature, index) => {
          const tag = document.createElement("div");
          tag.className = "feature-tag";
          tag.innerHTML = `
                    ${feature}
                    <span class="remove" onclick="removeFeature(${index})">&times;</span>
                `;
          list.appendChild(tag);
        });
      }

      // Remove feature
      function removeFeature(index) {
        currentFeatures.splice(index, 1);
        updateFeaturesDisplay();
      }

      // Close modal
      function closeModal() {
        document.getElementById("platformModal").style.display = "none";
      }

      // Show notification
      function showNotification(message, type = "info") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.style.display = "block";

        setTimeout(() => {
          notification.style.display = "none";
        }, 5000);
      }

      // Format numbers
      function formatNumber(num) {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + "M";
        if (num >= 1000) return (num / 1000).toFixed(1) + "K";
        return num.toString();
      }

      // Allow adding features with Enter key
      document
        .getElementById("featureInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            addFeature();
          }
        });

      // ===== EXAMPLES MANAGEMENT FUNCTIONS =====

      // Load all examples
      async function loadExamples() {
        try {
          const response = await fetch(
            "admin_platforms.php?action=get_examples"
          );
          const data = await response.json();

          if (data.success) {
            displayExamples(data.examples);
          } else {
            showNotification(data.message || "فشل في تحميل الأمثلة", "error");
          }
        } catch (error) {
          console.error("Error loading examples:", error);
          showNotification("حدث خطأ في الاتصال", "error");
        }
      }

      // Display examples in grid
      function displayExamples(examples) {
        const grid = document.getElementById("examplesGrid");
        grid.innerHTML = "";

        examples.forEach((example) => {
          const card = document.createElement("div");
          card.className = "platform-card";

          const technologies = example.technologies
            ? JSON.parse(example.technologies)
            : [];
          const techString =
            technologies.slice(0, 3).join(", ") +
            (technologies.length > 3 ? "..." : "");

          card.innerHTML = `
                    <div class="platform-header">
                        <div class="platform-title">${example.title}</div>
                        <div class="platform-status status-${
                          example.is_active ? "active" : "inactive"
                        }">
                            ${example.is_active ? "نشط" : "غير نشط"}
                        </div>
                    </div>
                    <div class="platform-stats">
                        <div>${getCategoryText(example.category)}</div>
                        <div>${getDifficultyText(example.difficulty)}</div>
                    </div>
                    <p style="color: var(--gray); font-size: 0.9rem; margin: 1rem 0;">
                        ${example.description.substring(0, 100)}${
            example.description.length > 100 ? "..." : ""
          }
                    </p>
                    <p style="color: var(--primary); font-size: 0.8rem; margin-bottom: 1rem;">
                        ${example.code_language} • ${techString}
                    </p>
                    <div class="platform-actions">
                        <button class="action-btn edit-btn" onclick="editExample(${
                          example.id
                        })">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteExample(${
                          example.id
                        })">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;

          grid.appendChild(card);
        });
      }

      // Open add example modal
      function openAddExampleModal() {
        document.getElementById("exampleModalTitle").textContent =
          "إضافة مثال جديد";
        document.getElementById("exampleForm").reset();
        document.getElementById("exampleId").value = "";
        currentTechnologies = [];
        updateTechDisplay();
        document.getElementById("specialEnvGroup").style.display = "none";
        document.getElementById("exampleModal").style.display = "block";
      }

      // Edit example
      async function editExample(id) {
        try {
          const response = await fetch(
            `admin_platforms.php?action=get_example&id=${id}`
          );
          const data = await response.json();

          if (data.success) {
            const example = data.example;
            document.getElementById("exampleModalTitle").textContent =
              "تعديل المثال";
            document.getElementById("exampleId").value = example.id;
            document.getElementById("exampleTitle").value = example.title;
            document.getElementById("exampleDescription").value =
              example.description;
            document.getElementById("exampleCategory").value = example.category;
            document.getElementById("exampleDifficulty").value =
              example.difficulty;
            document.getElementById("exampleCodeLanguage").value =
              example.code_language;
            document.getElementById("exampleCodeSnippet").value =
              example.code_snippet;
            document.getElementById("exampleImageUrl").value =
              example.image_url || "";
            document.getElementById("exampleDemoUrl").value =
              example.demo_url || "";
            document.getElementById("requiresSpecialEnv").checked =
              example.requires_special_env == 1;
            document.getElementById("specialEnvMessage").value =
              example.special_env_message || "";
            document.getElementById("exampleIsActive").checked =
              example.is_active == 1;

            currentTechnologies = example.technologies
              ? JSON.parse(example.technologies)
              : [];
            updateTechDisplay();
            toggleSpecialEnvMessage();

            document.getElementById("exampleModal").style.display = "block";
          } else {
            showNotification(
              data.message || "فشل في تحميل بيانات المثال",
              "error"
            );
          }
        } catch (error) {
          console.error("Error loading example:", error);
          showNotification("حدث خطأ في الاتصال", "error");
        }
      }

      // Delete example
      async function deleteExample(id) {
        if (!confirm("هل أنت متأكد من حذف هذا المثال؟")) {
          return;
        }

        try {
          const response = await fetch(
            `admin_platforms.php?action=delete_example&id=${id}`,
            {
              method: "DELETE",
            }
          );
          const data = await response.json();

          if (data.success) {
            showNotification("تم حذف المثال بنجاح", "success");
            loadExamples();
          } else {
            showNotification(data.message || "فشل في حذف المثال", "error");
          }
        } catch (error) {
          console.error("Error deleting example:", error);
          showNotification("حدث خطأ في الاتصال", "error");
        }
      }

      // Handle example form submission
      document
        .getElementById("exampleForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          formData.append("technologies", JSON.stringify(currentTechnologies));

          const isEdit = formData.get("id") !== "";
          const url = "admin_platforms.php";
          const method = isEdit ? "PUT" : "POST";

          // For PUT requests, we need to send as POST with _method
          if (method === "PUT") {
            formData.append("_method", "PUT");
          }

          try {
            const response = await fetch(url, {
              method: "POST",
              body: formData,
            });
            const data = await response.json();

            if (data.success) {
              showNotification(
                isEdit ? "تم تحديث المثال بنجاح" : "تم إضافة المثال بنجاح",
                "success"
              );
              closeExampleModal();
              loadExamples();
            } else {
              showNotification(data.message || "فشل في حفظ المثال", "error");
            }
          } catch (error) {
            console.error("Error saving example:", error);
            showNotification("حدث خطأ في الاتصال", "error");
          }
        });

      // Add technology
      function addTechnology() {
        const input = document.getElementById("techInput");
        const tech = input.value.trim();

        if (tech && !currentTechnologies.includes(tech)) {
          currentTechnologies.push(tech);
          updateTechDisplay();
          input.value = "";
        }
      }

      // Update technologies display
      function updateTechDisplay() {
        const list = document.getElementById("techList");
        list.innerHTML = "";

        currentTechnologies.forEach((tech, index) => {
          const tag = document.createElement("div");
          tag.className = "feature-tag";
          tag.innerHTML = `
                    ${tech}
                    <span class="remove" onclick="removeTechnology(${index})">&times;</span>
                `;
          list.appendChild(tag);
        });
      }

      // Remove technology
      function removeTechnology(index) {
        currentTechnologies.splice(index, 1);
        updateTechDisplay();
      }

      // Toggle special environment message field
      function toggleSpecialEnvMessage() {
        const checkbox = document.getElementById("requiresSpecialEnv");
        const group = document.getElementById("specialEnvGroup");
        const textarea = document.getElementById("specialEnvMessage");

        if (checkbox.checked) {
          group.style.display = "block";
          textarea.required = true;
        } else {
          group.style.display = "none";
          textarea.required = false;
          textarea.value = "";
        }
      }

      // Close example modal
      function closeExampleModal() {
        document.getElementById("exampleModal").style.display = "none";
      }

      // Helper functions for examples
      function getCategoryText(category) {
        const categories = {
          frontend: "Frontend",
          backend: "Backend",
          mobile: "تطبيقات الجوال",
          algorithms: "الخوارزميات",
        };
        return categories[category] || category;
      }

      function getDifficultyText(difficulty) {
        const difficulties = {
          beginner: "مبتدئ",
          intermediate: "متوسط",
          advanced: "متقدم",
        };
        return difficulties[difficulty] || difficulty;
      }

      // Allow adding technologies with Enter key
      document
        .getElementById("techInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            addTechnology();
          }
        });
    </script>
  </body>
</html>
